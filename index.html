<!DOCTYPE html>
<html lang="pt-br">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Plano de Expressão Quântico</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111827">

<style>
body{font-family:Arial;padding:30px;background:#f4f4f4}
input,button{padding:10px;margin:5px}
.card{background:#fff;padding:20px;margin-top:20px;border-radius:10px}
table{border-collapse:collapse;width:100%;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
.vermelho{color:#c0392b}
.azul{color:#2980b9}
.verde{color:#27ae60}
.amarelo{color:#f1c40f}

.bloco-momento{
  margin-top:60px;
  padding:30px;
  background:#111827;
  color:white;
  border-radius:10px;
}
.bar-bg{background:#2a2a2a;height:18px;border-radius:10px;margin:8px 0;}
.bar{height:100%;width:0%;border-radius:10px;transition:1s;}
.fisico{background:#ff4d4d;}
.mental{background:#4da6ff;}
.emocional{background:#33cc66;}
.intuitivo{background:#ffd633;}
.criativo { background: #a855f7; } 
.indeciso { background: #f97316; } 
.neutro { background: #94a3b8; }  
.resumoMomento{margin-top:25px;padding:20px;background:#1f2937;border-radius:8px;}
/* Esconde o texto que fica abaixo das barras */
#txtFisicoNat, #txtMentalNat, #txtEmocionalNat, #txtIntuitivoNat,
#txtFisico, #txtMental, #txtEmocional, #txtIntuitivo {
    display: none;
}
input {
  width: 600px;
  font-size: 18px;
  padding: 14px;
  background-color: #e5e7eb; 
  border: 1px solid #ccc;    
  color: #333;               
  display: block;            
  margin: 10px auto;         
}
  
/* MOBILE */
@media (max-width:768px){
  body{padding:15px;}
  h1{font-size:28px;}
  input,button,select{width:100%;box-sizing:border-box;margin:8px 0;}
  .bloco-momento{padding:20px;margin-top:30px;}
}
  
#resultado {
    font-size: 18px;
}
@media (max-width: 768px) {
    .container-inputs { 
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    input, select {
        display: block !important; 
        width: 90% !important;     
        margin-bottom: 25px;      
    }
} 
</style>

</head>
<body>

<h1>Plano de Expressão Quântico</h1>
Nome Completo (igual certidão)
<input id="nome" placeholder="">
  Data de Nascimento
<input type="date" id="dataNascimento" required data-placeholder="Data de Nascimento">
                 
<button onclick="gerarTudo()">GERAR o seu Plano de Expressão</button>
<button onclick="exportarRelatorio()">LIberar o acesso ao relatório e baixar o PDF</button>

<div id="natural" class="card"></div>
<div id="momento" style="display:none"></div>

<section class="bloco-momento" id="blocoNatural">
<h2>PLANO NATURAL</h2>
<div>
Físico: <span id="numFisicoNat"></span><div class="bar-bg"><div id="barFisicoNat" class="bar fisico"></div></div><p id="txtFisicoNat"></p>
Mental: <span id="numMentalNat"></span><div class="bar-bg"><div id="barMentalNat" class="bar mental"></div></div><p id="txtMentalNat"></p>
Emocional: <span id="numEmocionalNat"></span><div class="bar-bg"><div id="barEmocionalNat" class="bar emocional"></div></div><p id="txtEmocionalNat"></p>
Intuitivo: <span id="numIntuitivoNat"></span><div class="bar-bg"><div id="barIntuitivoNat" class="bar intuitivo"></div></div><p id="txtIntuitivoNat"></p>
<hr style="border: 0; border-top: 1px solid #374151; margin: 20px 0;">
Criativo: <span id="numCriativoNat"></span><div class="bar-bg"><div id="barCriativoNat" class="bar criativo"></div></div>
Indeciso: <span id="numIndecisoNat"></span><div class="bar-bg"><div id="barIndecisoNat" class="bar indeciso"></div></div>
Neutro: <span id="numNeutroNat"></span><div class="bar-bg"><div id="barNeutroNat" class="bar neutro"></div></div> 
<div id="resumoExpressaoNat" class="resumoMomento" style="margin-top:10px; border-left: 4px solid #a855f7;"></div>  
</div>
<div id="resumoNatural" class="resumoMomento"></div>
</section>

<section class="bloco-momento">
<h2>STATUS DO MOMENTO</h2>
<select id="anoSelect"></select>
<button onclick="gerarStatusMomento()">Gerar Status</button>

<div>
Físico: <span id="numFisico"></span><div class="bar-bg"><div id="barFisico" class="bar fisico"></div></div><p id="txtFisico"></p>
Mental: <span id="numMental"></span><div class="bar-bg"><div id="barMental" class="bar mental"></div></div><p id="txtMental"></p>
Emocional: <span id="numEmocional"></span><div class="bar-bg"><div id="barEmocional" class="bar emocional"></div></div><p id="txtEmocional"></p>
Intuitivo: <span id="numIntuitivo"></span><div class="bar-bg"><div id="barIntuitivo" class="bar intuitivo"></div></div><p id="txtIntuitivo"></p>
<hr style="border: 0; border-top: 1px solid #374151; margin: 20px 0;">
Criativo: <span id="numCriativoMom"></span><div class="bar-bg"><div id="barCriativoMom" class="bar criativo"></div></div>
Indeciso: <span id="numIndecisoMom"></span><div class="bar-bg"><div id="barIndecisoMom" class="bar indeciso"></div></div>
Neutro: <span id="numNeutroMom"></span><div class="bar-bg"><div id="barNeutroMom" class="bar neutro"></div></div>
<div id="resumoExpressaoMom" class="resumoMomento" style="margin-top:10px; border-left: 4px solid #a855f7;"></div>  
</div>

<div id="resumoMomento" class="resumoMomento"></div>

<div id="blocoTrânsitoAnual" class="resumoMomento" style="margin-top:20px; border-top: 4px solid #ffd633;">
    <h3 style="color: #ffd633;">VIBRAÇÃO DE TRÂNSITO DO ANO</h3>
    <div id="resultadoTrânsito"></div>
</div>
</section>

<script src="textos.js"></script>
<script>
// ============================================
// 1. FUNÇÕES DE PERSONALIZAÇÃO (O PULO DO GATO)
// ============================================

function formatarNomeDinamico() {
    let nomeInput = document.getElementById("nome").value.trim();
    if (!nomeInput) return "Você";
    let primeiroNome = nomeInput.split(' ')[0];
    return primeiroNome.charAt(0).toUpperCase() + primeiroNome.slice(1).toLowerCase();
}

function aplicarFiltroTexto(texto) {
    if (!texto) return "";
    let nome = formatarNomeDinamico();
    // Substitui todas as variações de "você" pelo nome em negrito
    return texto.replace(/você/gi, `<strong>${nome}</strong>`);
}

// ============================================
// 2. LÓGICA DE CÁLCULO E TABELAS
// ============================================

const tabela = { A:1, J:1, I:1, Q:1, Y:1, B:2, K:2, R:2, C:3, G:3, L:3, S:3, D:4, M:4, T:4, E:5, H:5, N:5, U:6, V:6, W:6, X:6, Ç:6, O:7, Z:7, F:8, P:8 };
const tabelaExpressao = {
    'E':'criativo','W':'indeciso','D':'neutro','M':'neutro',
    'A':'criativo','H':'indeciso','J':'indeciso','N':'indeciso','P':'indeciso','G':'neutro','L':'neutro',
    'I':'criativo','O':'criativo','R':'criativo','Z':'criativo','B':'indeciso','S':'indeciso','T':'indeciso','X':'indeciso',
    'K':'criativo','F':'indeciso','Q':'indeciso','U':'indeciso','Y':'indeciso','C':'neutro','V':'neutro'
};
const planos = { fisico: ["E","W","D","M"], mental: ["A","H","J","N","P","G","L"], emocional: ["I","O","R","Z","B","S","T","X"], intuitivo: ["K","F","Q","U","Y","C","V"] };

let bancoMomentos = [];
let resultadoPlanosNatural = null;
let valoresBrutosNatural = null;

function calcularValorComAcentos(letra) {
    const base = letra.normalize("NFD")[0];
    const valorBase = tabela[base] || 0;
    let soma = 0, mult = 1;
    for(let c of letra.normalize("NFD")) {
        if(c==="\u0301") soma+=2; else if(c==="\u0302") soma+=7;
        else if(c==="\u0303") soma+=3; else if(c==="\u0327") soma+=6;
        else if(c==="\u0300" || c==="\u0308") mult*=2;
    }
    return (valorBase + soma) * mult;
}

function reduzirNumero(n) {
    if (n === 0) return 0;
    while(n > 9) n = n.toString().split("").reduce((a,b) => a + Number(b), 0);
    return n;
}

function descobrirPlano(letra) {
    let l = letra.normalize("NFD")[0].toUpperCase();
    for(let p in planos) if(planos[p].includes(l)) return p;
    return null;
}

function classificarIntensidade(valor, maior) {
    if (valor >= maior * 0.75) return "forte";
    if (valor >= maior * 0.5) return "medio";
    return "fraco";
}

function atualizarTabela3(letras, sufixo) {
    let cont = { criativo: 0, indeciso: 0, neutro: 0 };
    letras.forEach(l => {
        if(!l) return;
        let letra = l.normalize("NFD")[0].toUpperCase();
        if (tabelaExpressao[letra]) cont[tabelaExpressao[letra]]++;
    });
    const maior = Math.max(cont.criativo, cont.indeciso, cont.neutro);
    ["Criativo", "Indeciso", "Neutro"].forEach(id => {
        let val = cont[id.toLowerCase()];
        let larg = maior > 0 ? Math.max((val / maior) * 100, 12) : 0;
        let elBar = document.getElementById("bar" + id + sufixo);
        let elNum = document.getElementById("num" + id + sufixo);
        if(elBar) elBar.style.width = larg + "%";
        if(elNum) { elNum.innerText = val; elNum.style.display = "none"; }
    });
    let dominanteExpressao = Object.keys(cont).reduce((a, b) => cont[a] >= cont[b] ? a : b);
    let campoTexto = document.getElementById("resumoExpressao" + sufixo);
    if(campoTexto && typeof textosExpressao !== 'undefined') {
        let textoBruto = textosExpressao[dominanteExpressao] || "";
        campoTexto.innerHTML = aplicarFiltroTexto(textoBruto);
        campoTexto.style.display = "block"; 
    }
}

function gerarTextoPlano(tipo, dados) {
    const nomesAmigaveis = { fisico: "Plano Físico", mental: "Plano Mental", emocional: "Plano Emocional", intuitivo: "Plano Intuitivo" };
    let planosOrdenados = Object.keys(dados)
        .map(chave => ({ chave, valor: Number(dados[chave].valorReal) || 0, nivel: dados[chave].nivel, num: dados[chave].numero }))
        .sort((a, b) => b.valor - a.valor);

    let textoFinal = (introducoes[tipo] || "") + "\n\n";
    planosOrdenados.forEach((plano, index) => {
        let posicao = index + 1;
        let nomePlano = nomesAmigaveis[plano.chave];
        textoFinal += `${posicao}ºIntensidade - ${nomePlano} \n`;
        if (typeof explicacoesPosicao !== 'undefined') textoFinal += (explicacoesPosicao[posicao] || "") + "\n\n";
        if (typeof textosPlanos !== 'undefined' && textosPlanos[plano.chave]) {
            let txt = textosPlanos[plano.chave][plano.nivel][plano.num];
            textoFinal += (txt || "") + "\n\n";
        }
        if (index < 3 && typeof conectores !== 'undefined') textoFinal += conectores[Math.floor(Math.random() * conectores.length)] + "\n\n";
    });

    // TEXTOS BASE (FALLBACK)
    const baseTextos = {
        fisico: {
            fraco: "Sua falta de praticidade e objetividade pode dificultar colocar planos em andamento.",
            medio: "O bom senso é sua chave. Você cumpre atividades mantendo o foco.",
            forte: "Suas atitudes são poderosas e seguras, focando na solução imediata."
        },
        mental: {
            fraco: "Pode ter dificuldade em resistir a opiniões alheias.",
            medio: "Você é cauteloso e lida bem com questões complexas.",
            forte: "Extremamente analítico e racional, com grande capacidade de liderança."
        },
        emocional: {
            fraco: "Pode ter problemas em expressar sentimentos.",
            medio: "Equilíbrio emocional pleno e comunicação saudável.",
            forte: "Suas emoções comandam suas decisões, alimentando muita criatividade."
        },
        intuitivo: {
            fraco: "O lado espiritual não é prioridade imediata.",
            medio: "Introspectivo, usa o recolhimento para recuperar energia.",
            forte: "Sentido espiritual vital, capta intenções facilmente."
        }
    };

    const p1 = planosOrdenados[0]; const p4 = planosOrdenados[3];
    let conclusaoDinamica = "";
    if (p1.nivel === "forte" && p4.nivel === "fraco") {
        conclusaoDinamica = `Você opera em Alta Polaridade. Sua força no ${nomesAmigaveis[p1.chave]} protege sua fragilidade no ${nomesAmigaveis[p4.chave]}.`;
    } else {
        conclusaoDinamica = `Seu perfil mostra uma dinâmica entre ${nomesAmigaveis[p1.chave]} e ${nomesAmigaveis[p4.chave]}.`;
    }

    let textoVeredito = `--- \n SÍNTESE DO PERFIL \n\n`;
    textoVeredito += `Sua Força Principal (${nomesAmigaveis[p1.chave]}): \n${baseTextos[p1.chave][p1.nivel]} \n\n`;
    textoVeredito += `Seu Desafio Atual (${nomesAmigaveis[p4.chave]}): \n${baseTextos[p4.chave][p4.nivel]} \n\n`;
    textoVeredito += `A CONEXÃO FINAL: \n${conclusaoDinamica}`;
    
    return aplicarFiltroTexto(textoFinal + "\n" + textoVeredito);
}

function planoNatural(nome) {
    let soma = { fisico: 0, mental: 0, emocional: 0, intuitivo: 0 };
    for(let l of nome.toUpperCase()) {
        let p = descobrirPlano(l);
        if(p) soma[p] += calcularValorComAcentos(l);
    }
    const maior = Math.max(soma.fisico, soma.mental, soma.emocional, soma.intuitivo);
    const dados = {
        fisico: { nivel: classificarIntensidade(soma.fisico, maior), numero: reduzirNumero(soma.fisico), valorReal: soma.fisico },
        mental: { nivel: classificarIntensidade(soma.mental, maior), numero: reduzirNumero(soma.mental), valorReal: soma.mental },
        emocional: { nivel: classificarIntensidade(soma.emocional, maior), numero: reduzirNumero(soma.emocional), valorReal: soma.emocional },
        intuitivo: { nivel: classificarIntensidade(soma.intuitivo, maior), numero: reduzirNumero(soma.intuitivo), valorReal: soma.intuitivo }
    };
    resultadoPlanosNatural = dados; valoresBrutosNatural = soma;
    document.getElementById("resumoNatural").innerHTML = gerarTextoPlano("natural", dados);
    for(let p in soma) atualizarBarraNatural(p.charAt(0).toUpperCase() + p.slice(1) + "Nat", soma[p], maior, dados[p].numero);
    atualizarTabela3(nome.split(""), "Nat");
}

function planoMomento(nomeCompleto, data) {
    bancoMomentos = [];
    const dt = new Date(data + 'T00:00:00');
    const dia = String(dt.getDate()).padStart(2, '0');
    const mes = String(dt.getMonth() + 1).padStart(2, '0');
    const partes = nomeCompleto.toUpperCase().trim().split(/\s+/);
    let timelines = partes.map(p => {
        let t = [];
        for(let l of p) { let v = calcularValorComAcentos(l); for(let i=0; i<v; i++) t.push(l); }
        return t;
    });
    for (let i = 0; i <= 100; i++) {
        let soma = { fisico: 0, mental: 0, emocional: 0, intuitivo: 0 };
        let letras = timelines.map(t => t[i % t.length]);
        letras.forEach(l => {
            let p = descobrirPlano(l);
            if(p) soma[p] += calcularValorComAcentos(l);
        });
        const anoI = dt.getFullYear() + i;
        bancoMomentos.push({ ano: anoI, intervalo: `de ${dia}/${mes}/${anoI} até ${dia}/${mes}/${anoI + 1}`, letras: letras, ...soma });
    }
    const sel = document.getElementById("anoSelect");
    sel.innerHTML = bancoMomentos.map(a => `<option value="${a.ano}">${a.ano}</option>`).join("");
}

function gerarStatusMomento() {
    const ano = document.getElementById("anoSelect").value;
    const d = bancoMomentos.find(a => a.ano == ano);
    if (!d) return;
    const maior = Math.max(d.fisico, d.mental, d.emocional, d.intuitivo);
    const red = { fisico: reduzirNumero(d.fisico), mental: reduzirNumero(d.mental), emocional: reduzirNumero(d.emocional), intuitivo: reduzirNumero(d.intuitivo) };

    for(let p in d) {
        if(p !== "ano" && p !== "letras" && p !== "intervalo") {
            atualizarBarraNatural(p.charAt(0).toUpperCase() + p.slice(1), d[p], maior, reduzirNumero(d[p]));
        }
    }
    atualizarTabela3(d.letras, "Mom");

    const dadosTxt = {
        fisico: { nivel: classificarIntensidade(d.fisico, maior), numero: red.fisico, valorReal: d.fisico },
        mental: { nivel: classificarIntensidade(d.mental, maior), numero: red.mental, valorReal: d.mental },
        emocional: { nivel: classificarIntensidade(d.emocional, maior), numero: red.emocional, valorReal: d.emocional },
        intuitivo: { nivel: classificarIntensidade(d.intuitivo, maior), numero: red.intuitivo, valorReal: d.intuitivo }
    };
    document.getElementById("resumoMomento").innerHTML = "No ano de " + ano + " (" + d.intervalo + "):\n\n" + gerarTextoPlano("momento", dadosTxt);

    const somaTransito = d.fisico + d.mental + d.emocional + d.intuitivo;
    const numTransito = reduzirNumero(somaTransito);
    let txtTransito = (typeof textosTrânsito !== 'undefined' && textosTrânsito[numTransito]) ? aplicarFiltroTexto(textosTrânsito[numTransito]) : "A vibração deste ciclo é " + numTransito;
    
    document.getElementById("resultadoTrânsito").innerHTML = `
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
            <span style="background:#ffd633; color:#000; padding:5px 12px; border-radius:50%; font-weight:bold; font-size:1.4rem;">${numTransito}</span>
        </div>
        <p>${txtTransito}</p>
    `;
}

function atualizarBarraNatural(tipo, val, maior, red) {
    let larg = maior > 0 ? Math.max((val/maior)*100, 12) : 0;
    let elBar = document.getElementById("bar"+tipo);
    if(elBar) elBar.style.width = larg + "%";
    let elNum = document.getElementById("num"+tipo);
    if(elNum) { elNum.innerText = red; elNum.style.display = "none"; }
}

function gerarTudo() {
    const n = document.getElementById("nome").value;
    const d = document.getElementById("dataNascimento").value;
    if(!n || !d) return alert("Preencha nome e data.");
    planoNatural(n); planoMomento(n, d); gerarStatusMomento();
}

function exportarRelatorio() {
    if(!resultadoPlanosNatural) return alert("Gere o mapa primeiro.");
    
    // Captura os valores das barras do Natural
    const valNat = valoresBrutosNatural;
    const expNat = document.getElementById("resumoExpressaoNat").innerHTML;
    
    // Captura os valores do Momento selecionado
    const ano = document.getElementById("anoSelect").value;
    const d = bancoMomentos.find(a => a.ano == ano);

    const pacote = {
        nome: document.getElementById("nome").value,
        data: document.getElementById("dataNascimento").value,
        anoMomento: ano,
        inicioFimMomento: d.intervalo, 
        // Textos
        textoNatural: document.getElementById("resumoNatural").innerHTML,
        textoMomento: document.getElementById("resumoMomento").innerHTML,
        textoExpressaoNat: expNat,
        textoExpressaoMom: document.getElementById("resumoExpressaoMom").innerHTML,
        transitoHTML: document.getElementById("resultadoTrânsito").innerHTML,
        // Valores para os Gráficos Natural
        fisico: valNat.fisico,
        mental: valNat.mental,
        emocional: valNat.emocional,
        intuitivo: valNat.intuitivo,
        criativoNat: parseInt(document.getElementById("numCriativoNat").innerText),
        indecisoNat: parseInt(document.getElementById("numIndecisoNat").innerText),
        neutroNat: parseInt(document.getElementById("numNeutroNat").innerText),
        // Valores para os Gráficos Momento
        fisicoMomento: d.fisico,
        mentalMomento: d.mental,
        emocionalMomento: d.emocional,
        intuitivoMomento: d.intuitivo,
        criativoMom: parseInt(document.getElementById("numCriativoMom").innerText),
        indecisoMom: parseInt(document.getElementById("numIndecisoMom").innerText),
        neutroMom: parseInt(document.getElementById("numNeutroMom").innerText)
    };
    
    localStorage.setItem("relatorioMapa", JSON.stringify(pacote));
    window.open("premium.html", "_blank");
}
</script>

<script>
if ("serviceWorker" in navigator) { navigator.serviceWorker.register("sw.js"); }
document.oncontextmenu=()=>false;
document.onselectstart=()=>false; 
</script>
</body>
</html>
