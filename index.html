<!DOCTYPE html>
<html lang="pt-br">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Plano de ExpressÃ£o CabalÃ­stico</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111827">

<style>
body{font-family:Arial;padding:30px;background:#f4f4f4}
input,button{padding:10px;margin:5px}
.card{background:#fff;padding:20px;margin-top:20px;border-radius:10px}
table{border-collapse:collapse;width:100%;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
.vermelho{color:#c0392b}
.azul{color:#2980b9}
.verde{color:#27ae60}
.amarelo{color:#f1c40f}

.bloco-momento{
  margin-top:60px;
  padding:30px;
  background:#111827;
  color:white;
  border-radius:10px;
}
.bar-bg{background:#2a2a2a;height:18px;border-radius:10px;margin:8px 0;}
.bar{height:100%;width:0%;border-radius:10px;transition:1s;}
.fisico{background:#ff4d4d;}
.mental{background:#4da6ff;}
.emocional{background:#33cc66;}
.intuitivo{background:#ffd633;}
.resumoMomento{margin-top:25px;padding:20px;background:#1f2937;border-radius:8px;}

/* MOBILE */
@media (max-width:768px){
  body{padding:15px;}
  h1{font-size:28px;}
  input,button,select{width:100%;box-sizing:border-box;margin:8px 0;}
  .bloco-momento{padding:20px;margin-top:30px;}
}
</style>

</head>
<body>



<h1>Plano de ExpressÃ£o CabalÃ­stico</h1>

<input id="nome" placeholder="Nome completo">
<input type="date" id="dataNascimento">
<button onclick="gerarTudo()">GERAR MAPA</button>
<button onclick="exportarRelatorio()">GERAR RELATÃ“RIO PDF</button>

<div id="natural" class="card"></div>
<div id="momento" style="display:none"></div>
<section class="bloco-momento" id="blocoNatural">
<h2>PLANO NATURAL</h2>

<div>
FÃ­sico<div class="bar-bg"><div id="barFisicoNat" class="bar fisico"></div></div><p id="txtFisicoNat"></p>
Mental<div class="bar-bg"><div id="barMentalNat" class="bar mental"></div></div><p id="txtMentalNat"></p>
Emocional<div class="bar-bg"><div id="barEmocionalNat" class="bar emocional"></div></div><p id="txtEmocionalNat"></p>
Intuitivo<div class="bar-bg"><div id="barIntuitivoNat" class="bar intuitivo"></div></div><p id="txtIntuitivoNat"></p>
</div>

<div id="resumoNatural" class="resumoMomento"></div>
</section>
<section class="bloco-momento">
<h2>STATUS DO MOMENTO</h2>

<select id="anoSelect"></select>
<button onclick="gerarStatusMomento()">Gerar Status</button>

<div>
FÃ­sico<div class="bar-bg"><div id="barFisico" class="bar fisico"></div></div><p id="txtFisico"></p>
Mental<div class="bar-bg"><div id="barMental" class="bar mental"></div></div><p id="txtMental"></p>
Emocional<div class="bar-bg"><div id="barEmocional" class="bar emocional"></div></div><p id="txtEmocional"></p>
Intuitivo<div class="bar-bg"><div id="barIntuitivo" class="bar intuitivo"></div></div><p id="txtIntuitivo"></p>
</div>

<div id="resumoMomento" class="resumoMomento"></div>
</section>
<script src="textos.js"></script>
<script>
//================ TABELA CABALÃSTICA
const tabela={
A:1,J:1,I:1,Q:1,Y:1,
B:2,K:2,R:2,
C:3,G:3,L:3,S:3,
D:4,M:4,T:4,
E:5,H:5,N:5,
U:6,V:6,W:6,X:6,Ã‡:6,
O:7,Z:7,
F:8,P:8
};

//================ ACENTOS
function calcularValorComAcentos(letra){
 const base=letra.normalize("NFD")[0];
 const valorBase=tabela[base];
 if(!valorBase) return 0;
 let soma=0,mult=1;
 for(let c of letra.normalize("NFD")){
  if(c==="\u0301") soma+=2;
  else if(c==="\u0302") soma+=7;
  else if(c==="\u0303") soma+=3;
  else if(c==="\u0327") soma+=6;
  else if(c==="\u0300") mult*=2;
  else if(c==="\u0308") mult*=2;
 }
 return (valorBase+soma)*mult;
}

function gerarTextoPlano(tipo, dados){

  let textoFinal = gerarIntroducao(tipo, dados) + "\n\n";

  const ordemPlanos = ["fisico","mental","emocional","intuitivo"];

  // ðŸ”¹ INTRODUÃ‡ÃƒO
  if(introducoes && introducoes[tipo]){
    textoFinal += introducoes[tipo].trim() + "\n\n";
  }

  ordemPlanos.forEach((plano, i)=>{

    const nivel = dados[plano].nivel;   // fraco medio forte
    const numero = dados[plano].numero; // 1 a 9

   
    // ðŸ”¹ CONECTOR ENTRE PLANOS
    if(i > 0){
      const conector = conectores[Math.floor(Math.random()*conectores.length)];
      textoFinal += "\n\n" + conector + "\n\n";
    }

  

// ðŸ”¹ NOVO MOTOR (BANCO textosPlanos)
let blocoPlano = textosPlanos?.[plano]?.[nivel]?.[numero] || 
`[Texto ainda nÃ£o criado: ${plano} ${nivel} nÂº ${numero}]`;

    textoFinal += blocoPlano;

  });

  // ðŸ”¹ CONCLUSÃƒO
  if(conclusoes && conclusoes[tipo]){
    textoFinal += "\n\n" + conclusoes[tipo].trim();
  }

 textoFinal += "\n\n" + gerarConclusao(tipo, dados);
return textoFinal;
}



// ===============================
// ANALISADOR GERAL DO MAPA
// ===============================

function analisarMapa(dados){

  const planos = ["fisico","mental","emocional","intuitivo"];

  let fortes = [];
  let medios = [];
  let fracos = [];

  planos.forEach(p=>{
    if(dados[p].nivel === "forte") fortes.push(p);
    else if(dados[p].nivel === "medio") medios.push(p);
    else fracos.push(p);
  });

  // plano dominante (se existir)
  let dominante = fortes.length === 1 ? fortes[0] : null;

  // dupla dominante
  let duplaDominante = fortes.length === 2 ? fortes : null;

  // equilÃ­brio geral
  let equilibrado = fortes.length === 0 && fracos.length === 0;

  // mapa muito interno (mental + emocional + intuitivo fortes)
  let interno = fortes.filter(p=>p!=="fisico").length >= 2;

  // mapa muito prÃ¡tico (fisico forte + outro forte)
  let pratico = fortes.includes("fisico") && fortes.length >= 2;

  return {
    fortes,
    medios,
    fracos,
    dominante,
    duplaDominante,
    equilibrado,
    interno,
    pratico
  };
}

// ===============================
// INTRODUÃ‡ÃƒO AUTOMÃTICA DO MAPA
// ===============================

function gerarIntroducao(tipo, dadosTexto){

  const analise = analisarMapa(dadosTexto);

  let texto = "";

  // ================= PARÃGRAFO 1 â€” VISÃƒO GERAL
  texto += tipo === "natural"
    ? "O seu Plano de ExpressÃ£o Natural revela como sua energia se manifesta de forma permanente ao longo da vida. "
    : "O seu Plano de ExpressÃ£o do Momento revela as energias predominantes deste perÃ­odo da sua vida. ";

  if(analise.dominante){
    texto += `Observa-se uma forte predominÃ¢ncia do plano ${analise.dominante}, indicando que esta Ã© a principal forma atravÃ©s da qual vocÃª tende a agir, reagir e se posicionar diante da realidade. `;
  }
  else if(analise.duplaDominante){
    texto += `Existe uma dupla predominÃ¢ncia entre os planos ${analise.duplaDominante[0]} e ${analise.duplaDominante[1]}, mostrando uma combinaÃ§Ã£o marcante dessas duas formas de expressÃ£o na sua vida. `;
  }
  else if(analise.equilibrado){
    texto += "Os quatro planos apresentam distribuiÃ§Ã£o equilibrada, indicando uma personalidade versÃ¡til e adaptÃ¡vel. ";
  }

  if(analise.fracos.length){
    texto += `Os planos menos ativos sÃ£o ${analise.fracos.join(", ")}, apontando Ã¡reas que podem exigir maior esforÃ§o, consciÃªncia e desenvolvimento ao longo do tempo.`;
  }

  // ================= PARÃGRAFO 2 â€” DINÃ‚MICA ENERGÃ‰TICA
  texto += "\n\n";

  if(analise.interno){
    texto += "A predominÃ¢ncia de planos internos indica uma natureza mais voltada ao mundo subjetivo, reflexivo e sensÃ­vel. ";
  }

  if(analise.pratico){
    texto += "A presenÃ§a forte do plano fÃ­sico indica grande ligaÃ§Ã£o com a realidade prÃ¡tica, aÃ§Ã£o concreta e materializaÃ§Ã£o. ";
  }

  if(analise.fortes.length === 1){
    texto += "Essa configuraÃ§Ã£o sugere uma personalidade bem direcionada, com tendÃªncia a agir sempre a partir de um eixo dominante.";
  }
  else if(analise.fortes.length >= 2){
    texto += "Essa configuraÃ§Ã£o revela uma personalidade multifacetada, com diferentes forÃ§as atuando simultaneamente.";
  }
  else{
    texto += "Essa configuraÃ§Ã£o sugere uma personalidade em busca de fortalecimento e desenvolvimento das suas energias principais.";
  }

  return texto;
}

function gerarConclusao(tipo, dados){

  const planos = ["fisico","mental","emocional","intuitivo"];

  // descobrir plano dominante e fraco
  let dominante = planos[0];
  let fraco = planos[0];

  planos.forEach(p=>{
    if(dados[p].nivel == "forte") dominante = p;
    if(dados[p].nivel == "fraco") fraco = p;
  });

  const nomes = {
    fisico:"plano fÃ­sico",
    mental:"plano mental",
    emocional:"plano emocional",
    intuitivo:"plano intuitivo"
  };

  return `
Em sÃ­ntese, este perÃ­odo revela a predominÃ¢ncia do ${nomes[dominante]},
enquanto o ${nomes[fraco]} aparece como Ã¡rea que exige maior atenÃ§Ã£o,
equilÃ­brio e desenvolvimento consciente.

A integraÃ§Ã£o harmoniosa desses quatro planos representa o caminho
para maior estabilidade, evoluÃ§Ã£o pessoal e realizaÃ§Ã£o prÃ¡tica ao
longo da vida.
  `;
}

function reduzirNumero(n){
 while(n > 9){
  n = n.toString().split("").reduce((a,b)=>a + Number(b),0);
 }
 return n;
}
//================ PLANOS
const planos={
 fisico:["E","W","D","M"],
 mental:["A","H","J","N","P","G","L"],
 emocional:["I","O","R","Z","B","S","T","X"],
 intuitivo:["K","F","Q","U","Y","C","V"]
};

function descobrirPlano(letra){
 letra=letra.normalize("NFD")[0].toUpperCase();
 for(let p in planos) if(planos[p].includes(letra)) return p;
 return null;
}

//================ BANCO ANUAL
let bancoMomentos=[];
// ===== DADOS GLOBAIS PARA O RELATÃ“RIO PREMIUM =====
let resultadoPlanosNatural = null;
let textoPlanoNaturalFinal = "";
let valoresBrutosNatural = null;  
//================ PLANO NATURAL
function planoNatural(nome){

 let soma={fisico:0,mental:0,emocional:0,intuitivo:0};

 for(let l of nome.toUpperCase()){
  let plano=descobrirPlano(l);
  if(!plano) continue;
  soma[plano]+=calcularValorComAcentos(l);
 }

 const maior=Math.max(soma.fisico,soma.mental,soma.emocional,soma.intuitivo);

// ðŸ”¢ NÃšMEROS REDUZIDOS (1 a 9)
const reducoes = {
 fisico: reduzirNumero(soma.fisico),
 mental: reduzirNumero(soma.mental),
 emocional: reduzirNumero(soma.emocional),
 intuitivo: reduzirNumero(soma.intuitivo)
};
// ðŸ”µ gera classificaÃ§Ã£o de intensidade
function classificar(valor, maior){
 if(valor >= maior*0.75) return "forte";
 if(valor >= maior*0.5) return "medio";
 return "fraco";
}

const intensidades = {
 fisico: classificar(soma.fisico, maior),
 mental: classificar(soma.mental, maior),
 emocional: classificar(soma.emocional, maior),
 intuitivo: classificar(soma.intuitivo, maior)
};

// monta objeto no formato correto para o gerador de texto
const dadosTexto = {
  fisico: { nivel:intensidades.fisico, numero:reducoes.fisico },
  mental: { nivel:intensidades.mental, numero:reducoes.mental },
  emocional: { nivel:intensidades.emocional, numero:reducoes.emocional },
  intuitivo: { nivel:intensidades.intuitivo, numero:reducoes.intuitivo }
};

// gera texto final correto
const textoPlanoNatural = gerarTextoPlano("natural", dadosTexto);
// salva para o relatÃ³rio premium
resultadoPlanosNatural = dadosTexto;
textoPlanoNaturalFinal = textoPlanoNatural;  
 // â­ SALVA OS NÃšMEROS REAIS (ESSENCIAL PARA O GRÃFICO DO PREMIUM)
valoresBrutosNatural = soma; 

// mostra na tela
document.getElementById("resumoNatural").innerText = textoPlanoNatural;


atualizarBarraNatural("FisicoNat",soma.fisico,maior,reducoes.fisico);
atualizarBarraNatural("MentalNat",soma.mental,maior,reducoes.mental);
atualizarBarraNatural("EmocionalNat",soma.emocional,maior,reducoes.emocional);
atualizarBarraNatural("IntuitivoNat",soma.intuitivo,maior,reducoes.intuitivo);

}





function planoMomento(nomeCompleto,data){

 bancoMomentos=[];

 const nomes = nomeCompleto
   .toUpperCase()
   .split(" ")
   .filter(n=>n.length>1);

 const anoNasc=new Date(data).getFullYear();

 // ðŸ”´ CRIA TIMELINE EXPANDIDA DE CADA NOME
 const timelines = nomes.map(nome=>{
    let linhaTempo=[];
    for(let letra of nome){
        let anos = calcularValorComAcentos(letra); // valor cabalÃ­stico
        for(let i=0;i<anos;i++){
            linhaTempo.push(letra);
        }
    }
    return linhaTempo;
 });

 let html="<h2>Plano do Momento</h2><table><tr><th>Ano</th><th>Idade</th>";
 nomes.forEach((n,i)=>html+=`<th>${i+1}Âº Nome</th>`);
 html+="<th>FÃ­sico</th><th>Mental</th><th>Emocional</th><th>Intuitivo</th></tr>";

 for(let idade=0;idade<=100;idade++){

  let ano=anoNasc+idade;
  let soma={fisico:0,mental:0,emocional:0,intuitivo:0};

  html+=`<tr><td>${ano}</td><td>${idade}</td>`;

  timelines.forEach(linhaTempo=>{
    const letra = linhaTempo[ idade ] || linhaTempo[ linhaTempo.length - 1 ];
      const plano = descobrirPlano(letra);
      const valor = calcularValorComAcentos(letra);
      soma[plano]+=valor;
      html+=`<td>${letra}</td>`;
  });

  bancoMomentos.push({ano,...soma});

  html+=`<td>${soma.fisico}</td>
         <td>${soma.mental}</td>
         <td>${soma.emocional}</td>
         <td>${soma.intuitivo}</td></tr>`;
 }

 html+="</table>";
 document.getElementById("momento").innerHTML=html;
 preencherSeletorAnos();
}
function preencherSeletorAnos(){
 const select=document.getElementById("anoSelect");
 select.innerHTML="";

 bancoMomentos.forEach(a=>{
   select.innerHTML+=`<option value="${a.ano}">${a.ano}</option>`;
 });

 // â­ ESSENCIAL â€” selecionar automaticamente o primeiro ano
 if(bancoMomentos.length > 0){
   select.value = bancoMomentos[0].ano;
 }
}
//================ STATUS DO MOMENTO (NOVO MOTOR)

function gerarStatusMomento(){

 const ano = document.getElementById("anoSelect").value;
 if(!ano){
   alert("Selecione um ano.");
   return;
 }

 const dados = bancoMomentos.find(a => a.ano == ano);
 if(!dados){
   alert("Erro ao localizar dados do ano.");
   return;
 }

 const maior = Math.max(dados.fisico,dados.mental,dados.emocional,dados.intuitivo);

 // atualiza barras
 atualizarBarra("Fisico",dados.fisico,maior);
 atualizarBarra("Mental",dados.mental,maior);
 atualizarBarra("Emocional",dados.emocional,maior);
 atualizarBarra("Intuitivo",dados.intuitivo,maior);

 // ðŸ”¢ nÃºmeros reduzidos
 const reducoesMomento = {
   fisico: reduzirNumero(dados.fisico),
   mental: reduzirNumero(dados.mental),
   emocional: reduzirNumero(dados.emocional),
   intuitivo: reduzirNumero(dados.intuitivo)
 };

 // ðŸ”µ classifica intensidade
 function classificar(valor, maior){
   if(valor >= maior*0.75) return "forte";
   if(valor >= maior*0.5) return "medio";
   return "fraco";
 }

 const intensidadesMomento = {
   fisico: classificar(dados.fisico, maior),
   mental: classificar(dados.mental, maior),
   emocional: classificar(dados.emocional, maior),
   intuitivo: classificar(dados.intuitivo, maior)
 };

 // ðŸ§  objeto pro motor de texto
 const dadosTextoMomento = {
   fisico:{ nivel:intensidadesMomento.fisico, numero:reducoesMomento.fisico },
   mental:{ nivel:intensidadesMomento.mental, numero:reducoesMomento.mental },
   emocional:{ nivel:intensidadesMomento.emocional, numero:reducoesMomento.emocional },
   intuitivo:{ nivel:intensidadesMomento.intuitivo, numero:reducoesMomento.intuitivo }
 };

 // âœ¨ gera texto final
 const textoMomento = gerarTextoPlano("momento", dadosTextoMomento);

 // mostra na tela
 document.getElementById("resumoMomento").innerText = textoMomento;


const textoBaseMomento = gerarTextoPlano("momento", dadosTextoMomento);

// â­ pega o ano escolhido
const anoSelecionado = document.getElementById("anoSelect").value;

// â­ cria texto final com ano
const textoMomentoFinal =
"No ano de " + anoSelecionado + ", o seu Plano de ExpressÃ£o do Momento revela:\n\n"
+ textoBaseMomento;

// mostra na tela
document.getElementById("resumoMomento").innerText = textoMomentoFinal;
}
//================ BARRAS (MANTIDAS)

function atualizarBarra(tipo,valor,maior){
 let largura=0;

 if(maior>0 && valor>0){
   largura=(valor/maior)*100;
   if(largura<12) largura=12;
 }

 document.getElementById("bar"+tipo).style.width=largura+"%";
 document.getElementById("txt"+tipo).innerText=valor;
}



function atualizarBarraNatural(tipo,valor,maior,reducao){
 let largura=0;

 if(maior>0 && valor>0){
   largura=(valor/maior)*100;
   if(largura<12) largura=12;
 }

 document.getElementById("bar"+tipo).style.width=largura+"%";
 document.getElementById("txt"+tipo).innerText=
  valor+" â†’ NÃºmero "+reducao;
}
// =======================
// BOTÃƒO PRINCIPAL
// =======================
function gerarTudo(){

  const nome = document.getElementById("nome").value;
  const data = document.getElementById("dataNascimento").value;

  if(!nome || !data){
    alert("Digite nome e data.");
    return;
  }

  // gera plano natural
  planoNatural(nome);

  // gera timeline do momento
  planoMomento(nome, data);

  // jÃ¡ calcula automaticamente o primeiro status
  gerarStatusMomento();

}

//================ EXPORTAR PARA RELATÃ“RIO PREMIUM
function exportarRelatorio(){

 const nome = document.getElementById("nome").value;
 const data = document.getElementById("dataNascimento").value;
 const anoSelecionado = document.getElementById("anoSelect").value;

 if(!nome || !data || bancoMomentos.length === 0){
   alert("Gere o mapa antes de exportar o relatÃ³rio.");
   return;
 }

 // pega dados do plano natural direto das barras
// pega nÃºmeros REAIS do plano natural (sem texto da tela)
const natural = {
  fisico: resultadoPlanosNatural.fisico.numero === undefined ? 0 : 
          resultadoPlanosNatural.fisico.numero, // nÃ£o usado no grÃ¡fico, mas mantido

  mental: resultadoPlanosNatural.mental.numero === undefined ? 0 :
          resultadoPlanosNatural.mental.numero,

  emocional: resultadoPlanosNatural.emocional.numero === undefined ? 0 :
             resultadoPlanosNatural.emocional.numero,

  intuitivo: resultadoPlanosNatural.intuitivo.numero === undefined ? 0 :
             resultadoPlanosNatural.intuitivo.numero
};

 // pega dados do ano escolhido
 const dadosAno = bancoMomentos.find(a => a.ano == anoSelecionado);

 const momento = {
   ano: anoSelecionado,
   fisico: dadosAno.fisico,
   mental: dadosAno.mental,
   emocional: dadosAno.emocional,
   intuitivo: dadosAno.intuitivo
 };

const pacoteRelatorio = {
  nome: nome,
  data: data,
  natural: natural,
  momento: momento,
anoMomento: anoSelecionado,
  // valores dos planos naturais (das barras)
// ðŸ”¥ AGORA ENVIANDO OS NÃšMEROS CORRETOS
fisico: valoresBrutosNatural.fisico,
mental: valoresBrutosNatural.mental,
emocional: valoresBrutosNatural.emocional,
intuitivo: valoresBrutosNatural.intuitivo,
// ðŸ”µ VALORES BRUTOS DO MOMENTO (NOVO)
fisicoMomento: dadosAno.fisico,
mentalMomento: dadosAno.mental,
emocionalMomento: dadosAno.emocional,
intuitivoMomento: dadosAno.intuitivo,
  // textos completos jÃ¡ gerados na tela
  textoNatural: document.getElementById("resumoNatural").innerText,
  textoMomento: document.getElementById("resumoMomento").innerText
};

  


 // salva no navegador
 localStorage.setItem("relatorioMapa", JSON.stringify(pacoteRelatorio));

 // abre pÃ¡gina premium
 window.open("https://hemricciinstintosuperior-rcci.github.io/app-plano-de-expressao/premium.html", "_blank");
}
</script>


<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

</script>
</body>
</html>
