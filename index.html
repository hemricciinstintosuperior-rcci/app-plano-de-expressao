<!DOCTYPE html>
<html lang="pt-br">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Plano de Express√£o Cabal√≠stico</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111827">

<style>
body{font-family:Arial;padding:30px;background:#f4f4f4}
input,button{padding:10px;margin:5px}
.card{background:#fff;padding:20px;margin-top:20px;border-radius:10px}
table{border-collapse:collapse;width:100%;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
.vermelho{color:#c0392b}
.azul{color:#2980b9}
.verde{color:#27ae60}
.amarelo{color:#f1c40f}

.bloco-momento{
  margin-top:60px;
  padding:30px;
  background:#111827;
  color:white;
  border-radius:10px;
}
.bar-bg{background:#2a2a2a;height:18px;border-radius:10px;margin:8px 0;}
.bar{height:100%;width:0%;border-radius:10px;transition:1s;}
.fisico{background:#ff4d4d;}
.mental{background:#4da6ff;}
.emocional{background:#33cc66;}
.intuitivo{background:#ffd633;}
.resumoMomento{margin-top:25px;padding:20px;background:#1f2937;border-radius:8px;}

/* MOBILE */
@media (max-width:768px){
  body{padding:15px;}
  h1{font-size:28px;}
  input,button,select{width:100%;box-sizing:border-box;margin:8px 0;}
  .bloco-momento{padding:20px;margin-top:30px;}
}
</style>

</head>
<body>



<h1>Plano de Express√£o Cabal√≠stico</h1>

<input id="nome" placeholder="Nome completo">
<input type="date" id="dataNascimento">
<button onclick="gerarTudo()">GERAR MAPA</button>
<button onclick="exportarRelatorio()">GERAR RELAT√ìRIO PDF</button>

<div id="natural" class="card"></div>
<div id="momento" style="display:none"></div>
<section class="bloco-momento" id="blocoNatural">
<h2>PLANO NATURAL</h2>

<div>
F√≠sico<div class="bar-bg"><div id="barFisicoNat" class="bar fisico"></div></div><p id="txtFisicoNat"></p>
Mental<div class="bar-bg"><div id="barMentalNat" class="bar mental"></div></div><p id="txtMentalNat"></p>
Emocional<div class="bar-bg"><div id="barEmocionalNat" class="bar emocional"></div></div><p id="txtEmocionalNat"></p>
Intuitivo<div class="bar-bg"><div id="barIntuitivoNat" class="bar intuitivo"></div></div><p id="txtIntuitivoNat"></p>
</div>

<div id="resumoNatural" class="resumoMomento"></div>
</section>
<section class="bloco-momento">
<h2>STATUS DO MOMENTO</h2>

<select id="anoSelect"></select>
<button onclick="gerarStatusMomento()">Gerar Status</button>

<div>
F√≠sico<div class="bar-bg"><div id="barFisico" class="bar fisico"></div></div><p id="txtFisico"></p>
Mental<div class="bar-bg"><div id="barMental" class="bar mental"></div></div><p id="txtMental"></p>
Emocional<div class="bar-bg"><div id="barEmocional" class="bar emocional"></div></div><p id="txtEmocional"></p>
Intuitivo<div class="bar-bg"><div id="barIntuitivo" class="bar intuitivo"></div></div><p id="txtIntuitivo"></p>
</div>

<div id="resumoMomento" class="resumoMomento"></div>
</section>
<script src="textos.js"></script>
<script>
//================ TABELA CABAL√çSTICA
const tabela={
A:1,J:1,I:1,Q:1,Y:1,
B:2,K:2,R:2,
C:3,G:3,L:3,S:3,
D:4,M:4,T:4,
E:5,H:5,N:5,
U:6,V:6,W:6,X:6,√á:6,
O:7,Z:7,
F:8,P:8
};

//================ ACENTOS
function calcularValorComAcentos(letra){
 const base=letra.normalize("NFD")[0];
 const valorBase=tabela[base];
 if(!valorBase) return 0;
 let soma=0,mult=1;
 for(let c of letra.normalize("NFD")){
  if(c==="\u0301") soma+=2;
  else if(c==="\u0302") soma+=7;
  else if(c==="\u0303") soma+=3;
  else if(c==="\u0327") soma+=6;
  else if(c==="\u0300") mult*=2;
  else if(c==="\u0308") mult*=2;
 }
 return (valorBase+soma)*mult;
}

function gerarTextoPlano(tipo, dados){

  let textoFinal = gerarIntroducao(tipo, dados) + "\n\n";

  const ordemPlanos = ["fisico","mental","emocional","intuitivo"];

  // üîπ INTRODU√á√ÉO
  if(introducoes && introducoes[tipo]){
    textoFinal += introducoes[tipo].trim() + "\n\n";
  }

  ordemPlanos.forEach((plano, i)=>{

    const nivel = dados[plano].nivel;   // fraco medio forte
    const numero = dados[plano].numero; // 1 a 9

   
    // üîπ CONECTOR ENTRE PLANOS
    if(i > 0){
      const conector = conectores[Math.floor(Math.random()*conectores.length)];
      textoFinal += "\n\n" + conector + "\n\n";
    }

  

// üîπ NOVO MOTOR (BANCO textosPlanos)
let blocoPlano = textosPlanos?.[plano]?.[nivel]?.[numero] || 
`[Texto ainda n√£o criado: ${plano} ${nivel} n¬∫ ${numero}]`;

    textoFinal += blocoPlano;

  });

  // üîπ CONCLUS√ÉO
  if(conclusoes && conclusoes[tipo]){
    textoFinal += "\n\n" + conclusoes[tipo].trim();
  }

 textoFinal += "\n\n" + gerarConclusao(tipo, dados);
return textoFinal;
}



// ===============================
// ANALISADOR GERAL DO MAPA
// ===============================

function analisarMapa(dados){

  const planos = ["fisico","mental","emocional","intuitivo"];

  let fortes = [];
  let medios = [];
  let fracos = [];

  planos.forEach(p=>{
    if(dados[p].nivel === "forte") fortes.push(p);
    else if(dados[p].nivel === "medio") medios.push(p);
    else fracos.push(p);
  });

  // plano dominante (se existir)
  let dominante = fortes.length === 1 ? fortes[0] : null;

  // dupla dominante
  let duplaDominante = fortes.length === 2 ? fortes : null;

  // equil√≠brio geral
  let equilibrado = fortes.length === 0 && fracos.length === 0;

  // mapa muito interno (mental + emocional + intuitivo fortes)
  let interno = fortes.filter(p=>p!=="fisico").length >= 2;

  // mapa muito pr√°tico (fisico forte + outro forte)
  let pratico = fortes.includes("fisico") && fortes.length >= 2;

  return {
    fortes,
    medios,
    fracos,
    dominante,
    duplaDominante,
    equilibrado,
    interno,
    pratico
  };
}

// ===============================
// INTRODU√á√ÉO AUTOM√ÅTICA DO MAPA
// ===============================

function gerarIntroducao(tipo, dadosTexto){

  const analise = analisarMapa(dadosTexto);

  let texto = "";

  // ================= PAR√ÅGRAFO 1 ‚Äî VIS√ÉO GERAL
  texto += tipo === "natural"
    ? "O seu Plano de Express√£o Natural revela como sua energia se manifesta de forma permanente ao longo da vida. "
    : "O seu Plano de Express√£o do Momento revela as energias predominantes deste per√≠odo da sua vida. ";

  if(analise.dominante){
    texto += `Observa-se uma forte predomin√¢ncia do plano ${analise.dominante}, indicando que esta √© a principal forma atrav√©s da qual voc√™ tende a agir, reagir e se posicionar diante da realidade. `;
  }
  else if(analise.duplaDominante){
    texto += `Existe uma dupla predomin√¢ncia entre os planos ${analise.duplaDominante[0]} e ${analise.duplaDominante[1]}, mostrando uma combina√ß√£o marcante dessas duas formas de express√£o na sua vida. `;
  }
  else if(analise.equilibrado){
    texto += "Os quatro planos apresentam distribui√ß√£o equilibrada, indicando uma personalidade vers√°til e adapt√°vel. ";
  }

  if(analise.fracos.length){
    texto += `Os planos menos ativos s√£o ${analise.fracos.join(", ")}, apontando √°reas que podem exigir maior esfor√ßo, consci√™ncia e desenvolvimento ao longo do tempo.`;
  }

  // ================= PAR√ÅGRAFO 2 ‚Äî DIN√ÇMICA ENERG√âTICA
  texto += "\n\n";

  if(analise.interno){
    texto += "A predomin√¢ncia de planos internos indica uma natureza mais voltada ao mundo subjetivo, reflexivo e sens√≠vel. ";
  }

  if(analise.pratico){
    texto += "A presen√ßa forte do plano f√≠sico indica grande liga√ß√£o com a realidade pr√°tica, a√ß√£o concreta e materializa√ß√£o. ";
  }

  if(analise.fortes.length === 1){
    texto += "Essa configura√ß√£o sugere uma personalidade bem direcionada, com tend√™ncia a agir sempre a partir de um eixo dominante.";
  }
  else if(analise.fortes.length >= 2){
    texto += "Essa configura√ß√£o revela uma personalidade multifacetada, com diferentes for√ßas atuando simultaneamente.";
  }
  else{
    texto += "Essa configura√ß√£o sugere uma personalidade em busca de fortalecimento e desenvolvimento das suas energias principais.";
  }

  return texto;
}

function gerarConclusao(tipo, dados){

  const nomes = {
    fisico:"plano f√≠sico",
    mental:"plano mental",
    emocional:"plano emocional",
    intuitivo:"plano intuitivo"
  };

  // transforma objeto em array orden√°vel
  const ordenado = Object.keys(dados)
    .map(plano => ({
      plano,
      valor: dados[plano].valorReal ?? dados[plano].numero ?? 0
    }))
    .sort((a,b) => b.valor - a.valor);

  const dominante = ordenado[0].plano;
  const fraco = ordenado[ordenado.length - 1].plano;

  return `
Em s√≠ntese, este per√≠odo revela a predomin√¢ncia do ${nomes[dominante]},
enquanto o ${nomes[fraco]} aparece como √°rea que exige maior aten√ß√£o,
equil√≠brio e desenvolvimento consciente.

A integra√ß√£o harmoniosa desses quatro planos representa o caminho
para maior estabilidade, evolu√ß√£o pessoal e realiza√ß√£o pr√°tica ao
longo da vida.
  `;
}

function reduzirNumero(n){
 while(n > 9){
  n = n.toString().split("").reduce((a,b)=>a + Number(b),0);
 }
 return n;
}
//================ PLANOS
const planos={
 fisico:["E","W","D","M"],
 mental:["A","H","J","N","P","G","L"],
 emocional:["I","O","R","Z","B","S","T","X"],
 intuitivo:["K","F","Q","U","Y","C","V"]
};

function descobrirPlano(letra){
 letra=letra.normalize("NFD")[0].toUpperCase();
 for(let p in planos) if(planos[p].includes(letra)) return p;
 return null;
}

//================ BANCO ANUAL
let bancoMomentos=[];
// ===== DADOS GLOBAIS PARA O RELAT√ìRIO PREMIUM =====
let resultadoPlanosNatural = null;
let textoPlanoNaturalFinal = "";
let valoresBrutosNatural = null;  
//================ PLANO NATURAL
function planoNatural(nome){

 let soma={fisico:0,mental:0,emocional:0,intuitivo:0};

 for(let l of nome.toUpperCase()){
  let plano=descobrirPlano(l);
  if(!plano) continue;
  soma[plano]+=calcularValorComAcentos(l);
 }

 const maior=Math.max(soma.fisico,soma.mental,soma.emocional,soma.intuitivo);

// üî¢ N√öMEROS REDUZIDOS (1 a 9)
const reducoes = {
 fisico: reduzirNumero(soma.fisico),
 mental: reduzirNumero(soma.mental),
 emocional: reduzirNumero(soma.emocional),
 intuitivo: reduzirNumero(soma.intuitivo)
};
// üîµ gera classifica√ß√£o de intensidade
function classificar(valor, maior){
 if(valor >= maior*0.75) return "forte";
 if(valor >= maior*0.5) return "medio";
 return "fraco";
}

const intensidades = {
 fisico: classificar(soma.fisico, maior),
 mental: classificar(soma.mental, maior),
 emocional: classificar(soma.emocional, maior),
 intuitivo: classificar(soma.intuitivo, maior)
};

// monta objeto no formato correto para o gerador de texto
const dadosTexto = {
  fisico: { nivel:intensidades.fisico, numero:reducoes.fisico, valorReal:soma.fisico },
  mental: { nivel:intensidades.mental, numero:reducoes.mental, valorReal:soma.mental },
  emocional: { nivel:intensidades.emocional, numero:reducoes.emocional, valorReal:soma.emocional },
  intuitivo: { nivel:intensidades.intuitivo, numero:reducoes.intuitivo, valorReal:soma.intuitivo }
};

// gera texto final correto
const textoPlanoNatural = gerarTextoPlano("natural", dadosTexto);
// salva para o relat√≥rio premium
resultadoPlanosNatural = dadosTexto;
textoPlanoNaturalFinal = textoPlanoNatural;  
 // ‚≠ê SALVA OS N√öMEROS REAIS (ESSENCIAL PARA O GR√ÅFICO DO PREMIUM)
valoresBrutosNatural = soma; 

// mostra na tela
document.getElementById("resumoNatural").innerText = textoPlanoNatural;


atualizarBarraNatural("FisicoNat",soma.fisico,maior,reducoes.fisico);
atualizarBarraNatural("MentalNat",soma.mental,maior,reducoes.mental);
atualizarBarraNatural("EmocionalNat",soma.emocional,maior,reducoes.emocional);
atualizarBarraNatural("IntuitivoNat",soma.intuitivo,maior,reducoes.intuitivo);

}

function planoMomento(nomeCompleto,data){

 bancoMomentos=[];

 const anoNasc = new Date(data).getFullYear();

 // üî¥ 1) SEPARAR NOMES CORRETAMENTE (colar part√≠culas ao sobrenome)
 const partes = nomeCompleto.toUpperCase().trim().split(/\s+/);
 let blocos=[];
 let buffer="";

 partes.forEach(p=>{
   if(["DA","DE","DO","DAS","DOS"].includes(p)){
      buffer += p;
   }else{
      blocos.push(buffer + p);
      buffer="";
   }
 });

 // üî¥ 2) CRIAR TIMELINE DE CADA BLOCO
 let timelines=[];

 blocos.forEach(nome=>{
   let timeline=[];

   for(let letra of nome){
     const anos = calcularValorComAcentos(letra);

     for(let i=0;i<anos;i++){
       timeline.push(letra);
     }
   }

   timelines.push(timeline);
 });

 // seguran√ßa
 if(timelines.length===0){
   alert("Nome inv√°lido");
   return;
 }

 // üî¥ 3) PERCORRER VIDA (0‚Äì100 anos)
 for(let idade=0; idade<=100; idade++){

   const ano = anoNasc + idade;

   let soma={
     fisico:0,
     mental:0,
     emocional:0,
     intuitivo:0
   };

   // ‚≠ê PEGA UMA LETRA DE CADA BLOCO (vertical)
   timelines.forEach(timeline=>{

    const posicao = idade % timeline.length;
const letra = timeline[posicao];

     const plano = descobrirPlano(letra);
     const valor = calcularValorComAcentos(letra);

     if(plano==="fisico") soma.fisico += valor;
     if(plano==="mental") soma.mental += valor;
     if(plano==="emocional") soma.emocional += valor;
     if(plano==="intuitivo") soma.intuitivo += valor;

   });

   bancoMomentos.push({ano,...soma});
 }

 preencherSeletorAnos();
}

function preencherSeletorAnos(){
 const select=document.getElementById("anoSelect");
 select.innerHTML="";

 bancoMomentos.forEach(a=>{
   select.innerHTML+=`<option value="${a.ano}">${a.ano}</option>`;
 });

 // ‚≠ê ESSENCIAL ‚Äî selecionar automaticamente o primeiro ano
 if(bancoMomentos.length > 0){
   select.value = bancoMomentos[0].ano;
 }
}
//================ STATUS DO MOMENTO (NOVO MOTOR)

function gerarStatusMomento(){

 const ano = document.getElementById("anoSelect").value;
 if(!ano){
   alert("Selecione um ano.");
   return;
 }

 const dados = bancoMomentos.find(a => a.ano == ano);
 if(!dados){
   alert("Erro ao localizar dados do ano.");
   return;
 }

const maior = Math.max(dados.fisico,dados.mental,dados.emocional,dados.intuitivo);

// 1Ô∏è‚É£ REDU√á√ïES (PRIMEIRO!)
const reducoesMomento = {
  fisico: reduzirNumero(dados.fisico),
  mental: reduzirNumero(dados.mental),
  emocional: reduzirNumero(dados.emocional),
  intuitivo: reduzirNumero(dados.intuitivo)
};

// 2Ô∏è‚É£ ATUALIZA BARRAS (IGUAL AO NATURAL)
atualizarBarraNatural("Fisico",dados.fisico,maior,reducoesMomento.fisico);
atualizarBarraNatural("Mental",dados.mental,maior,reducoesMomento.mental);
atualizarBarraNatural("Emocional",dados.emocional,maior,reducoesMomento.emocional);
atualizarBarraNatural("Intuitivo",dados.intuitivo,maior,reducoesMomento.intuitivo);

// 3Ô∏è‚É£ CLASSIFICA INTENSIDADE
function classificar(valor, maior){
  if(valor >= maior*0.75) return "forte";
  if(valor >= maior*0.5) return "medio";
  return "fraco";
}

const intensidadesMomento = {
  fisico: classificar(dados.fisico, maior),
  mental: classificar(dados.mental, maior),
  emocional: classificar(dados.emocional, maior),
  intuitivo: classificar(dados.intuitivo, maior)
};

const dadosTextoMomento = {
  fisico:{ nivel:intensidadesMomento.fisico, numero:reducoesMomento.fisico, valorReal:dados.fisico },
  mental:{ nivel:intensidadesMomento.mental, numero:reducoesMomento.mental, valorReal:dados.mental },
  emocional:{ nivel:intensidadesMomento.emocional, numero:reducoesMomento.emocional, valorReal:dados.emocional },
  intuitivo:{ nivel:intensidadesMomento.intuitivo, numero:reducoesMomento.intuitivo, valorReal:dados.intuitivo }
};

const textoBaseMomento = gerarTextoPlano("momento", dadosTextoMomento);
const anoSelecionado = document.getElementById("anoSelect").value;

const textoMomentoFinal =
"No ano de " + anoSelecionado + ", o seu Plano de Express√£o do Momento revela:\n\n"
+ textoBaseMomento;

document.getElementById("resumoMomento").innerText = textoMomentoFinal;


}
//================ BARRAS (MANTIDAS)

function atualizarBarra(tipo,valor,maior){
 let largura=0;

 if(maior>0 && valor>0){
   largura=(valor/maior)*100;
   if(largura<12) largura=12;
 }

 document.getElementById("bar"+tipo).style.width=largura+"%";
 document.getElementById("txt"+tipo).innerText=valor;
}



function atualizarBarraNatural(tipo,valor,maior,reducao){
 let largura=0;

 if(maior>0 && valor>0){
   largura=(valor/maior)*100;
   if(largura<12) largura=12;
 }

 document.getElementById("bar"+tipo).style.width=largura+"%";
 document.getElementById("txt"+tipo).innerText=
  valor+" ‚Üí N√∫mero "+reducao;
}
// =======================
// BOT√ÉO PRINCIPAL
// =======================
function gerarTudo(){

  const nome = document.getElementById("nome").value;
  const data = document.getElementById("dataNascimento").value;

  if(!nome || !data){
    alert("Digite nome e data.");
    return;
  }

  // gera plano natural
  planoNatural(nome);

  // gera timeline do momento
  planoMomento(nome, data);

  // j√° calcula automaticamente o primeiro status
  gerarStatusMomento();

}

//================ EXPORTAR PARA RELAT√ìRIO PREMIUM
function exportarRelatorio(){

 const nome = document.getElementById("nome").value;
 const data = document.getElementById("dataNascimento").value;
 const anoSelecionado = document.getElementById("anoSelect").value;

 if(!nome || !data || bancoMomentos.length === 0){
   alert("Gere o mapa antes de exportar o relat√≥rio.");
   return;
 }

 // pega dados do plano natural direto das barras
// pega n√∫meros REAIS do plano natural (sem texto da tela)
const natural = {
  fisico: resultadoPlanosNatural.fisico.numero === undefined ? 0 : 
          resultadoPlanosNatural.fisico.numero, // n√£o usado no gr√°fico, mas mantido

  mental: resultadoPlanosNatural.mental.numero === undefined ? 0 :
          resultadoPlanosNatural.mental.numero,

  emocional: resultadoPlanosNatural.emocional.numero === undefined ? 0 :
             resultadoPlanosNatural.emocional.numero,

  intuitivo: resultadoPlanosNatural.intuitivo.numero === undefined ? 0 :
             resultadoPlanosNatural.intuitivo.numero
};

 // pega dados do ano escolhido
 const dadosAno = bancoMomentos.find(a => a.ano == anoSelecionado);

 const momento = {
   ano: anoSelecionado,
   fisico: dadosAno.fisico,
   mental: dadosAno.mental,
   emocional: dadosAno.emocional,
   intuitivo: dadosAno.intuitivo
 };

const pacoteRelatorio = {
  nome: nome,
  data: data,
  natural: natural,
  momento: momento,
anoMomento: anoSelecionado,
  // valores dos planos naturais (das barras)
// üî• AGORA ENVIANDO OS N√öMEROS CORRETOS
fisico: valoresBrutosNatural.fisico,
mental: valoresBrutosNatural.mental,
emocional: valoresBrutosNatural.emocional,
intuitivo: valoresBrutosNatural.intuitivo,
// üîµ VALORES BRUTOS DO MOMENTO (NOVO)
fisicoMomento: dadosAno.fisico,
mentalMomento: dadosAno.mental,
emocionalMomento: dadosAno.emocional,
intuitivoMomento: dadosAno.intuitivo,
  // textos completos j√° gerados na tela
  textoNatural: document.getElementById("resumoNatural").innerText,
  textoMomento: document.getElementById("resumoMomento").innerText
};

  


 // salva no navegador
 localStorage.setItem("relatorioMapa", JSON.stringify(pacoteRelatorio));

 // abre p√°gina premium
 window.open("https://hemricciinstintosuperior-rcci.github.io/app-plano-de-expressao/premium.html", "_blank");
}
</script>


<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
 // üîí BLOQUEIO C√ìPIA
// =======================
document.oncontextmenu=()=>false;
document.onselectstart=()=>false; 

</script>
</body>
</html>
