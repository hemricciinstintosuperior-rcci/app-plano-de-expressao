<!DOCTYPE html>
<html lang="pt-br">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Plano de Express√£o Cabal√≠stico</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111827">

<style>
body{font-family:Arial;padding:30px;background:#f4f4f4}
input,button{padding:10px;margin:5px}
.card{background:#fff;padding:20px;margin-top:20px;border-radius:10px}
table{border-collapse:collapse;width:100%;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
.vermelho{color:#c0392b}
.azul{color:#2980b9}
.verde{color:#27ae60}
.amarelo{color:#f1c40f}

.bloco-momento{
  margin-top:60px;
  padding:30px;
  background:#111827;
  color:white;
  border-radius:10px;
}
.bar-bg{background:#2a2a2a;height:18px;border-radius:10px;margin:8px 0;}
.bar{height:100%;width:0%;border-radius:10px;transition:1s;}
.fisico{background:#ff4d4d;}
.mental{background:#4da6ff;}
.emocional{background:#33cc66;}
.intuitivo{background:#ffd633;}
.criativo { background: #a855f7; } 
.indeciso { background: #f97316; } 
.neutro { background: #94a3b8; }  
.resumoMomento{margin-top:25px;padding:20px;background:#1f2937;border-radius:8px;}
/* Esconde o texto que fica abaixo das barras */
#txtFisicoNat, #txtMentalNat, #txtEmocionalNat, #txtIntuitivoNat,
#txtFisico, #txtMental, #txtEmocional, #txtIntuitivo {
    display: none;
}
input {
  width: 600px;
  font-size: 18px;
  padding: 14px;
  background-color: #e5e7eb; /* Cor cinza id√™ntica ao padr√£o do sistema */
  border: 1px solid #ccc;    /* Borda suave para dar profundidade */
  color: #333;               /* Cor do texto ao digitar */
  display: block;            /* Garante que fiquem um abaixo do outro */
  margin: 10px auto;         /* Centraliza e d√° espa√ßamento */
}
  
/* MOBILE */
@media (max-width:768px){
  body{padding:15px;}
  h1{font-size:28px;}
  input,button,select{width:100%;box-sizing:border-box;margin:8px 0;}
  .bloco-momento{padding:20px;margin-top:30px;}
}

 /* Isso for√ßa os campos a aparecerem e ficarem empilhados no celular */
@media (max-width: 768px) {
    .container-inputs { /* Use a classe que envolve seus inputs */
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    input, select {
        display: block !important; /* For√ßa a exibi√ß√£o */
        width: 90% !important;     /* Ajusta a largura para o celular */
        margin-bottom: 25px;      /* D√° um espa√ßo entre o nome e a data */
    }
} 
</style>

</head>
<body>



<h1>Plano de Express√£o Qu√¢ntico</h1>

Nome Completo (igual certid√£o)<input id="nome" placeholder="">
            Data de Nascimento<input type="date" id="dataNascimento" required data-placeholder="Data de Nascimento">
                 

  
<button onclick="gerarTudo()">GERAR MAPA</button>
<button onclick="exportarRelatorio()">GERAR RELAT√ìRIO PDF</button>

<div id="natural" class="card"></div>
<div id="momento" style="display:none"></div>
<section class="bloco-momento" id="blocoNatural">
<h2>PLANO NATURAL</h2>

<div>
F√≠sico: <span id="numFisicoNat"></span><div class="bar-bg"><div id="barFisicoNat" class="bar fisico"></div></div><p id="txtFisicoNat"></p>
Mental: <span id="numMentalNat"></span><div class="bar-bg"><div id="barMentalNat" class="bar mental"></div></div><p id="txtMentalNat"></p>
Emocional: <span id="numEmocionalNat"></span><div class="bar-bg"><div id="barEmocionalNat" class="bar emocional"></div></div><p id="txtEmocionalNat"></p>
Intuitivo: <span id="numIntuitivoNat"></span><div class="bar-bg"><div id="barIntuitivoNat" class="bar intuitivo"></div></div><p id="txtIntuitivoNat"></p>
<hr style="border: 0; border-top: 1px solid #374151; margin: 20px 0;">
Criativo: <span id="numCriativoNat"></span><div class="bar-bg"><div id="barCriativoNat" class="bar criativo"></div></div>
Indeciso: <span id="numIndecisoNat"></span><div class="bar-bg"><div id="barIndecisoNat" class="bar indeciso"></div></div>
Neutro: <span id="numNeutroNat"></span><div class="bar-bg"><div id="barNeutroNat" class="bar neutro"></div></div> 
<div id="resumoExpressaoNat" class="resumoMomento" style="margin-top:10px; border-left: 4px solid #a855f7;"></div>  
</div>

<div id="resumoNatural" class="resumoMomento"></div>
</section>
<section class="bloco-momento">
<h2>STATUS DO MOMENTO</h2>

<select id="anoSelect"></select>
<button onclick="gerarStatusMomento()">Gerar Status</button>

<div>
F√≠sico: <span id="numFisico"></span><div class="bar-bg"><div id="barFisico" class="bar fisico"></div></div><p id="txtFisico"></p>
Mental: <span id="numMental"></span><div class="bar-bg"><div id="barMental" class="bar mental"></div></div><p id="txtMental"></p>
Emocional: <span id="numEmocional"></span><div class="bar-bg"><div id="barEmocional" class="bar emocional"></div></div><p id="txtEmocional"></p>
Intuitivo: <span id="numIntuitivo"></span><div class="bar-bg"><div id="barIntuitivo" class="bar intuitivo"></div></div><p id="txtIntuitivo"></p>
<hr style="border: 0; border-top: 1px solid #374151; margin: 20px 0;">
Criativo: <span id="numCriativoMom"></span><div class="bar-bg"><div id="barCriativoMom" class="bar criativo"></div></div>
Indeciso: <span id="numIndecisoMom"></span><div class="bar-bg"><div id="barIndecisoMom" class="bar indeciso"></div></div>
Neutro: <span id="numNeutroMom"></span><div class="bar-bg"><div id="barNeutroMom" class="bar neutro"></div></div>
<div id="resumoExpressaoMom" class="resumoMomento" style="margin-top:10px; border-left: 4px solid #a855f7;"></div>  
</div>

<div id="resumoMomento" class="resumoMomento"></div>
</section>
<script src="textos.js"></script>
<script>
//================ TABELA CABAL√çSTICA
//================ CONFIGURA√á√ÉO E TABELAS
const tabela = { A:1, J:1, I:1, Q:1, Y:1, B:2, K:2, R:2, C:3, G:3, L:3, S:3, D:4, M:4, T:4, E:5, H:5, N:5, U:6, V:6, W:6, X:6, √á:6, O:7, Z:7, F:8, P:8 };

const tabelaExpressao = {
    'E':'criativo','W':'indeciso','D':'neutro','M':'neutro',
    'A':'criativo','H':'indeciso','J':'indeciso','N':'indeciso','P':'indeciso','G':'neutro','L':'neutro',
    'I':'criativo','O':'criativo','R':'criativo','Z':'criativo','B':'indeciso','S':'indeciso','T':'indeciso','X':'indeciso',
    'K':'criativo','F':'indeciso','Q':'indeciso','U':'indeciso','Y':'indeciso','C':'neutro','V':'neutro'
};

const planos = { fisico: ["E","W","D","M"], mental: ["A","H","J","N","P","G","L"], emocional: ["I","O","R","Z","B","S","T","X"], intuitivo: ["K","F","Q","U","Y","C","V"] };

let bancoMomentos = [];
let resultadoPlanosNatural = null;
let valoresBrutosNatural = null;

//================ FUN√á√ïES DE APOIO
function calcularValorComAcentos(letra) {
    const base = letra.normalize("NFD")[0];
    const valorBase = tabela[base] || 0;
    let soma = 0, mult = 1;
    for(let c of letra.normalize("NFD")) {
        if(c==="\u0301") soma+=2; else if(c==="\u0302") soma+=7;
        else if(c==="\u0303") soma+=3; else if(c==="\u0327") soma+=6;
        else if(c==="\u0300" || c==="\u0308") mult*=2;
    }
    return (valorBase + soma) * mult;
}

function reduzirNumero(n) {
    while(n > 9) n = n.toString().split("").reduce((a,b) => a + Number(b), 0);
    return n;
}

function descobrirPlano(letra) {
    let l = letra.normalize("NFD")[0].toUpperCase();
    for(let p in planos) if(planos[p].includes(l)) return p;
    return null;
}

function classificarIntensidade(valor, maior) {
    if (valor >= maior * 0.75) return "forte";
    if (valor >= maior * 0.5) return "medio";
    return "fraco";
}

//================ L√ìGICA DA TABELA 3 (TEXTOS E BARRAS)
function atualizarTabela3(letras, sufixo) {
    let cont = { criativo: 0, indeciso: 0, neutro: 0 };
    letras.forEach(l => {
        if(!l) return;
        let letra = l.normalize("NFD")[0].toUpperCase();
        if (tabelaExpressao[letra]) cont[tabelaExpressao[letra]]++;
    });

    const maior = Math.max(cont.criativo, cont.indeciso, cont.neutro);
    
    // Atualiza as Barras
    ["Criativo", "Indeciso", "Neutro"].forEach(id => {
        let val = cont[id.toLowerCase()];
        let larg = maior > 0 ? Math.max((val / maior) * 100, 12) : 0;
        let elBar = document.getElementById("bar" + id + sufixo);
        let elNum = document.getElementById("num" + id + sufixo);
        if(elBar) elBar.style.width = larg + "%";
        if(elNum) elNum.innerText = val;
    });

    // Descobre o dominante
    let dominante = Object.keys(cont).reduce((a, b) => cont[a] >= cont[b] ? a : b);
    let campoTexto = document.getElementById("resumoExpressao" + sufixo);
    
    // CONEX√ÉO COM O TEXTOS.JS (Usando innerHTML para aceitar textos grandes e formatados)
    if(campoTexto && typeof textosExpressao !== 'undefined') {
        // Usamos innerHTML para garantir que as quebras de linha e formata√ß√£o das crases funcionem
        campoTexto.innerHTML = textosExpressao[dominante] || "";
        campoTexto.style.display = "block"; 
    }
}

//================ MOTOR DE TEXTOS PLANOS
// ============================== MOTOR DE TEXTOS PLANOS ARRUMADO ==============================
function gerarTextoPlano(tipo, dados) {
    const nomesAmigaveis = {
        fisico: "Plano F√≠sico",
        mental: "Plano Mental",
        emocional: "Plano Emocional",
        intuitivo: "Plano Intuitivo"
    };

    // 1. RANKING POR INTENSIDADE (Soma Bruta)
    // Usamos 'valorReal' que cont√©m a soma total (11, 12, 20, etc) para ordenar
    let planosOrdenados = Object.keys(dados)
        .map(chave => ({ 
            chave, 
            intensidade: parseFloat(dados[chave].valorReal) || 0, // O n√∫mero alto/completo
            nivel: dados[chave].nivel, // O significado reduzido
            num: dados[chave].numero 
        }))
        .sort((a, b) => b.intensidade - a.intensidade); // Ordena pela for√ßa bruta

    // 2. Iniciar o texto com a Introdu√ß√£o
    let textoFinal = (introducoes[tipo] || "") + "\n\n";

    // 3. Montagem da Hierarquia do 1¬∫ ao 4¬∫
    planosOrdenados.forEach((plano, index) => {
        let posicao = index + 1;
        let nomePlano = nomesAmigaveis[plano.chave];
        
        // Exibe o t√≠tulo com a posi√ß√£o correta baseada na soma total
        textoFinal += `**${posicao}¬∫ - ${nomePlano}**\n`;
        
        // Explica√ß√£o da posi√ß√£o (1¬∫ ao 4¬∫)
        if (typeof explicacoesPosicao !== 'undefined') {
            textoFinal += (explicacoesPosicao[posicao] || "") + "\n\n";
        }
        
        // O conte√∫do t√©cnico (Aqui ele continua pegando o texto do n√∫mero REDUZIDO)
        if (typeof textosPlanos !== 'undefined' && textosPlanos[plano.chave]) {
            // plano.num √© o n√∫mero da redu√ß√£o (o significado)
            const textoTecnico = textosPlanos[plano.chave][plano.nivel][plano.num];
            textoFinal += (textoTecnico || "") + "\n\n";
        }
        
        // Conector narrativo
        if (index < 3 && typeof conectores !== 'undefined') {
            textoFinal += conectores[Math.floor(Math.random() * conectores.length)] + "\n\n";
        }
    });

    // 4. Conclus√£o Final corrigindo os nomes
    textoFinal += processarConclusao(tipo, planosOrdenados, nomesAmigaveis);

    return textoFinal;
}

// Fun√ß√£o para garantir que o ${nomes[fraco]} vire o nome real
function processarConclusao(tipo, ordenados, nomes) {
    if (typeof conclusoes === 'undefined' || !conclusoes[tipo]) return "";
    const dominante = ordenados[0].chave;
    const fraco = ordenados[3].chave;
    return conclusoes[tipo]
        .replace("${nomes[dominante]}", nomes[dominante])
        .replace("${nomes[fraco]}", nomes[fraco]);
}

// Fun√ß√£o de apoio para processar os nomes na conclus√£o
function processarConclusao(tipo, ordenados, nomes) {
    if (typeof conclusoes === 'undefined' || !conclusoes[tipo]) return "";
    
    const dominante = ordenados[0].chave; // O que ficou em 1¬∫
    const fraco = ordenados[3].chave;     // O que ficou em 4¬∫
    
    let frase = conclusoes[tipo];
    
    return frase
        .replace("${nomes[dominante]}", nomes[dominante])
        .replace("${nomes[fraco]}", nomes[fraco]);
}

// Fun√ß√£o auxiliar para evitar o erro de ${nomes[fraco]}
function processarConclusao(tipo, ordenados, nomes) {
    if (typeof conclusoes === 'undefined' || !conclusoes[tipo]) return "";
    
    const dominante = ordenados[0].chave; // O primeiro da lista (mais forte)
    const fraco = ordenados[3].chave;     // O √∫ltimo da lista (mais fraco)
    
    let frase = conclusoes[tipo];
    
    // Substitui manualmente os c√≥digos pelos nomes reais
    return frase
        .replace("${nomes[dominante]}", nomes[dominante])
        .replace("${nomes[fraco]}", nomes[fraco]);
}

//================ PLANO NATURAL
function planoNatural(nome) {
    let soma = { fisico: 0, mental: 0, emocional: 0, intuitivo: 0 };
    for(let l of nome.toUpperCase()) {
        let p = descobrirPlano(l);
        if(p) soma[p] += calcularValorComAcentos(l);
    }
    const maior = Math.max(soma.fisico, soma.mental, soma.emocional, soma.intuitivo);
    const dados = {
        fisico: { nivel: classificarIntensidade(soma.fisico, maior), numero: reduzirNumero(soma.fisico), valorReal: soma.fisico },
        mental: { nivel: classificarIntensidade(soma.mental, maior), numero: reduzirNumero(soma.mental), valorReal: soma.mental },
        emocional: { nivel: classificarIntensidade(soma.emocional, maior), numero: reduzirNumero(soma.emocional), valorReal: soma.emocional },
        intuitivo: { nivel: classificarIntensidade(soma.intuitivo, maior), numero: reduzirNumero(soma.intuitivo), valorReal: soma.intuitivo }
    };
    resultadoPlanosNatural = dados; valoresBrutosNatural = soma;
    document.getElementById("resumoNatural").innerText = gerarTextoPlano("natural", dados);
    for(let p in soma) atualizarBarraNatural(p.charAt(0).toUpperCase() + p.slice(1) + "Nat", soma[p], maior, dados[p].numero);
    atualizarTabela3(nome.split(""), "Nat");
}

//================ PLANO MOMENTO (COM DATAS EXATAS)
function planoMomento(nomeCompleto, data) {
    bancoMomentos = [];
    const dt = new Date(data + 'T00:00:00');
    const dia = String(dt.getDate()).padStart(2, '0');
    const mes = String(dt.getMonth() + 1).padStart(2, '0');
    const partes = nomeCompleto.toUpperCase().trim().split(/\s+/);
    let timelines = partes.map(p => {
        let t = [];
        for(let l of p) { let v = calcularValorComAcentos(l); for(let i=0; i<v; i++) t.push(l); }
        return t;
    });
    for (let i = 0; i <= 100; i++) {
        let soma = { fisico: 0, mental: 0, emocional: 0, intuitivo: 0 };
        let letras = timelines.map(t => t[i % t.length]);
        letras.forEach(l => {
            let p = descobrirPlano(l);
            if(p) soma[p] += calcularValorComAcentos(l);
        });
        const anoI = dt.getFullYear() + i;
        bancoMomentos.push({ 
            ano: anoI, 
            intervalo: `de ${dia}/${mes}/${anoI} at√© ${dia}/${mes}/${anoI + 1}`, 
            letras: letras, ...soma 
        });
    }
    const sel = document.getElementById("anoSelect");
    sel.innerHTML = bancoMomentos.map(a => `<option value="${a.ano}">${a.ano}</option>`).join("");
}

function gerarStatusMomento() {
    const ano = document.getElementById("anoSelect").value;
    const d = bancoMomentos.find(a => a.ano == ano);
    if (!d) return;
    const maior = Math.max(d.fisico, d.mental, d.emocional, d.intuitivo);
    const red = { fisico: reduzirNumero(d.fisico), mental: reduzirNumero(d.mental), emocional: reduzirNumero(d.emocional), intuitivo: reduzirNumero(d.intuitivo) };
    for(let p in d) if(p !== "ano" && p !== "letras" && p !== "intervalo") atualizarBarraNatural(p.charAt(0).toUpperCase() + p.slice(1), d[p], maior, reduzirNumero(d[p]));
    atualizarTabela3(d.letras, "Mom");
    const dadosTxt = {
        fisico: { nivel: classificarIntensidade(d.fisico, maior), numero: red.fisico },
        mental: { nivel: classificarIntensidade(d.mental, maior), numero: red.mental },
        emocional: { nivel: classificarIntensidade(d.emocional, maior), numero: red.emocional },
        intuitivo: { nivel: classificarIntensidade(d.intuitivo, maior), numero: red.intuitivo }
    };
    document.getElementById("resumoMomento").innerText = "No ano de " + ano + " (" + d.intervalo + "):\n\n" + gerarTextoPlano("momento", dadosTxt);
}

function atualizarBarraNatural(tipo, val, maior, red) {
    let larg = maior > 0 ? Math.max((val/maior)*100, 12) : 0;
    document.getElementById("bar"+tipo).style.width = larg + "%";
    document.getElementById("num"+tipo).innerText = red;
}

function gerarTudo() {
    const n = document.getElementById("nome").value;
    const d = document.getElementById("dataNascimento").value;
    if(!n || !d) return alert("Preencha nome e data.");
    planoNatural(n); planoMomento(n, d); gerarStatusMomento();
}

function exportarRelatorio() {
    if(!resultadoPlanosNatural) return alert("Gere o mapa primeiro.");
    
    const anoSel = document.getElementById("anoSelect").value;
    const dAno = bancoMomentos.find(a => a.ano == anoSel);

    const pacote = {
        nome: document.getElementById("nome").value,
        data: document.getElementById("dataNascimento").value,
        anoMomento: anoSel,
        
        // Dados dos Planos (F√≠sico, Mental, etc)
        fisico: valoresBrutosNatural.fisico,
        mental: valoresBrutosNatural.mental,
        emocional: valoresBrutosNatural.emocional,
        intuitivo: valoresBrutosNatural.intuitivo,
        fisicoMomento: dAno.fisico,
        mentalMomento: dAno.mental,
        emocionalMomento: dAno.emocional,
        intuitivoMomento: dAno.intuitivo,
        
        // Textos dos Planos
        textoNatural: document.getElementById("resumoNatural").innerText,
        textoMomento: document.getElementById("resumoMomento").innerText,

        // === AQUI EST√Å O QUE FALTA PARA O PREMIUM PARAR DE DAR UNDEFINED ===
        
        // N√∫meros da Tabela 3
        criativoNat: document.getElementById("numCriativoNat").innerText,
        indecisoNat: document.getElementById("numIndecisoNat").innerText,
        neutroNat: document.getElementById("numNeutroNat").innerText,
        
        criativoMom: document.getElementById("numCriativoMom").innerText,
        indecisoMom: document.getElementById("numIndecisoMom").innerText,
        neutroMom: document.getElementById("numNeutroMom").innerText,

        // Textos da Tabela 3 (O que aparece na caixa roxa)
        textoExpressaoNat: document.getElementById("resumoExpressaoNat").innerHTML,
        textoExpressaoMom: document.getElementById("resumoExpressaoMom").innerHTML
    };

    localStorage.setItem("relatorioMapa", JSON.stringify(pacote));
    window.open("https://hemricciinstintosuperior-rcci.github.io/app-plano-de-expressao/premium.html", "_blank");
}
</script>


<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
 // üîí BLOQUEIO C√ìPIA
// =======================
document.oncontextmenu=()=>false;
document.onselectstart=()=>false; 

</script>
</body>
</html>
