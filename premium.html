<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat√≥rio Premium</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
  padding:40px;
}

.card{
  background:#111827;
  padding:30px;
  border-radius:12px;
  max-width:700px;
  margin:auto;
}

button{
  padding:15px 25px;
  font-size:18px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#22c55e;
  color:white;
  margin-top:20px;
}

.erro{
  color:#ef4444;
  font-size:22px;
}

.ok{
  color:#22c55e;
  font-size:22px;
}
#paginaRelatorio{
  width:210mm;
  min-height:297mm;
  padding:20mm;
  margin:auto;
  background:white;
  color:black;
  font-family:Arial;
  box-sizing:border-box;
}

h1{ font-size:32px; }
h2{ font-size:24px; margin-top:20px; }
p{ font-size:16px; line-height:1.6; }

 body{
  background:#0f172a;
}

#conteudo{
  background:#0f172a;
} 
 /* ===== FOLHA A4 ===== */

.folha{
  width: 210mm;
  min-height: 297mm;
  background: white;
  padding: 25mm;
  margin: 20px auto;
  box-shadow: 0 0 15px rgba(0,0,0,0.15);
}
.page-break{
  page-break-after: always;
}
@media print{
  body{
    background:white;
  }
  .folha{
    box-shadow:none;
    margin:0;
  }
} 
</style>
</head>

<body>

<div class="card" id="conteudo">
Carregando acesso...
</div>
<!-- AREA DO RELAT√ìRIO (fica escondida at√© gerar PDF) -->
<div id="relatorioPDF" style="display:none; background:white; color:black; padding:40px">

  <h1>RELAT√ìRIO PREMIUM</h1>
  <h2>Plano de Express√£o Cabal√≠stico</h2>

  <hr>

  <h2>DADOS DO CLIENTE</h2>
  <p id="pdfNome"></p>
  <p id="pdfData"></p>

  <hr>

  <h2>OS 4 PLANOS DA EXIST√äNCIA</h2>
  <p>
  Este relat√≥rio revela como sua energia se distribui entre os quatro planos
  fundamentais da exist√™ncia humana: f√≠sico, mental, emocional e intuitivo.
  </p>

  <div id="pdfResultados"></div>

</div>
<script>
// ===============================
// üì¶ 1) CARREGAR DADOS DO MAPA PRIMEIRO
// ===============================
const dadosSalvos = localStorage.getItem("relatorioMapa");
  

if(!dadosSalvos){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>Nenhum mapa encontrado.<br>Volte e gere o mapa primeiro.</p>";
  throw new Error("Sem dados do mapa");
}
const relatorio = JSON.parse(dadosSalvos);
console.log("Relat√≥rio carregado:", relatorio);
  
window.relatorio = JSON.parse(dadosSalvos);
console.log("Relat√≥rio carregado:", relatorio);

  

  
  
  
 // ===============================
// üßæ PREENCHER RELAT√ìRIO PDF
// ===============================

// dados b√°sicos
document.getElementById("pdfNome").innerHTML =
  "<b>Nome:</b> " + relatorio.nome;

document.getElementById("pdfData").innerHTML =
  "<b>Data de nascimento:</b> " + relatorio.data;

// resultados dos planos
document.getElementById("pdfResultados").innerHTML = `
  <p><b>Plano F√≠sico:</b> ${relatorio.fisico}</p>
  <p><b>Plano Mental:</b> ${relatorio.mental}</p>
  <p><b>Plano Emocional:</b> ${relatorio.emocional}</p>
  <p><b>Plano Intuitivo:</b> ${relatorio.intuitivo}</p>
`; 
</script>

<script>
// =====================================
// üîê 2) SISTEMA DE PROTE√á√ÉO PREMIUM
// =====================================

// pega token da URL
const params = new URLSearchParams(window.location.search);
const token = params.get("token");

// lista de tokens v√°lidos (depois voc√™ altera manualmente)
const tokensValidos = [
  "ABC123",
  "MAPA777",
  "CLIENTE001"
];

// verifica se token existe
if(!token){
  bloquear("Acesso inv√°lido.");
}

// verifica se token √© v√°lido
if(!tokensValidos.includes(token)){
  bloquear("Token inv√°lido.");
}

// verifica se j√° foi usado
if(localStorage.getItem("token_usado_"+token)){
  bloquear("Este link j√° foi utilizado.");
}

// se chegou aqui ‚Üí acesso liberado
liberarAcesso();

function bloquear(msg){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>"+msg+"</p>";
  throw new Error("Acesso bloqueado");
}

function liberarAcesso(){

  document.getElementById("conteudo").innerHTML = `
  <div id="paginaRelatorio">
  <div class="folha">

  <!-- CAPA -->
  <h1 style="text-align:center;font-size:40px;margin-top:80px">
    RELAT√ìRIO PREMIUM
  </h1>

  <h2 style="text-align:center;margin-bottom:120px">
    Plano de Express√£o Cabal√≠stico
</h2>

<div class="page-break"></div>

<hr>
  <!-- DADOS -->
  <h2>Dados do Cliente</h2>
  <p><b>Nome:</b> ${relatorio.nome || "Cliente"}</p>
  <p><b>Data de nascimento:</b> ${relatorio.data || "-"}</p>

  <hr>

  <!-- INTRODU√á√ÉO -->
  <h2>O Plano de Express√£o</h2>
<p>
O Plano de Express√£o Cabal√≠stico √© uma an√°lise profunda baseada na estrutura vibracional do seu nome e da sua data de nascimento.
Este estudo revela como suas energias se organizam nos quatro planos fundamentais da experi√™ncia humana:
o plano f√≠sico, mental, emocional e intuitivo.
</p>

<p>
Cada um desses planos representa uma dimens√£o da forma como voc√™ pensa, sente, age e percebe a realidade.
Quando est√£o equilibrados, a pessoa vive com clareza, prop√≥sito e dire√ß√£o.
Quando est√£o em desequil√≠brio, surgem bloqueios, conflitos internos e sensa√ß√£o de falta de sentido.
</p>

<p>
Este relat√≥rio foi desenvolvido para revelar sua estrutura energ√©tica individual,
mostrando seus pontos fortes, desafios naturais e caminhos de evolu√ß√£o pessoal.
</p>

<p>
Ao longo das pr√≥ximas p√°ginas, voc√™ encontrar√° a an√°lise detalhada de cada plano,
seguida de interpreta√ß√µes personalizadas baseadas nos seus resultados.
</p>

  <hr>

  <!-- GR√ÅFICO (dados) -->
  <h2>Distribui√ß√£o dos Planos</h2>
  <p><b>F√≠sico:</b> ${relatorio.fisico || "-"}</p>
  <p><b>Mental:</b> ${relatorio.mental || "-"}</p>
  <p><b>Emocional:</b> ${relatorio.emocional || "-"}</p>
  <p><b>Intuitivo:</b> ${relatorio.intuitivo || "-"}</p>

  <hr>

  <!-- PLANOS -->
 <!-- PLANOS -->
<hr>

<h2>Plano de Express√£o Natural</h2>
<p style="white-space:pre-line">
${relatorio.textoNatural}
</p>

<hr>

<h2>Status do Momento</h2>

<p style="font-size:18px; margin-bottom:25px;">
<b>Vig√™ncia:</b> Ano ${relatorio.anoMomento}
</p>

<p style="white-space:pre-line">
${relatorio.textoMomento}
</p>
  <hr>

<h2>Encerramento</h2>
<p>
Este relat√≥rio representa um mapa simb√≥lico das suas tend√™ncias naturais.
Utilize estas informa√ß√µes como ferramenta de autoconhecimento e evolu√ß√£o.
</p>
</div>
</div>
`;
}

</script>

<script>

<!-- FOLHA A4 INVIS√çVEL PARA GERAR PDF -->
<div id="pdfFolha" style="
position:fixed;
left:-99999px;
top:0;
width:794px;
background:white;
padding:25px 30px;
box-sizing:border-box;
"></div>
  
window.onload = function(){

  setTimeout(()=>{

    const relatorio = document.getElementById("paginaRelatorio");
    const folha = document.getElementById("pdfFolha");

    if(!relatorio) return;

    // copia relat√≥rio para folha A4 invis√≠vel
    folha.innerHTML = relatorio.outerHTML;

    const opt = {
      margin:0,
      filename:"Relatorio_Plano_Expressao.pdf",
      image:{ type:"jpeg", quality:1 },
      html2canvas:{ scale:2, useCORS:true },
      jsPDF:{ unit:"px", format:"a4", orientation:"portrait" }
    };

    html2pdf().set(opt).from(folha).save();

  },2000); // espera renderizar tudo

}
</script>
</body>
</html>

