<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat√≥rio Premium</title>

<style>
body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
  padding:40px;
}

.card{
  background:#111827;
  padding:30px;
  border-radius:12px;
  max-width:700px;
  margin:auto;
}

button{
  padding:15px 25px;
  font-size:18px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#22c55e;
  color:white;
  margin-top:20px;
}

.erro{
  color:#ef4444;
  font-size:22px;
}

.ok{
  color:#22c55e;
  font-size:22px;
}
</style>
</head>

<body>

<div class="card" id="conteudo">
Carregando acesso...
</div>

<script>
// ===============================
// üì¶ 1) CARREGAR DADOS DO MAPA PRIMEIRO
// ===============================
const dadosSalvos = localStorage.getItem("relatorioMapa");

if(!dadosSalvos){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>Nenhum mapa encontrado.<br>Volte e gere o mapa primeiro.</p>";
  throw new Error("Sem dados do mapa");
}

const relatorio = JSON.parse(dadosSalvos);
console.log("Dados carregados:", relatorio);
</script>

<script>
// =====================================
// üîê 2) SISTEMA DE PROTE√á√ÉO PREMIUM
// =====================================

// pega token da URL
const params = new URLSearchParams(window.location.search);
const token = params.get("token");

// lista de tokens v√°lidos (depois voc√™ altera manualmente)
const tokensValidos = [
  "ABC123",
  "MAPA777",
  "CLIENTE001"
];

// verifica se token existe
if(!token){
  bloquear("Acesso inv√°lido.");
}

// verifica se token √© v√°lido
if(!tokensValidos.includes(token)){
  bloquear("Token inv√°lido.");
}

// verifica se j√° foi usado
if(localStorage.getItem("token_usado_"+token)){
  bloquear("Este link j√° foi utilizado.");
}

// se chegou aqui ‚Üí acesso liberado
liberarAcesso();

function bloquear(msg){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>"+msg+"</p>";
  throw new Error("Acesso bloqueado");
}

function liberarAcesso(){
  // marca token como usado
  localStorage.setItem("token_usado_"+token, "usado");

  document.getElementById("conteudo").innerHTML = `
    <h1 class="ok">Acesso liberado ‚úî</h1>
    <p>Seu relat√≥rio personalizado est√° pronto.</p>

    <button onclick="gerarPDF()">
      GERAR RELAT√ìRIO EM PDF
    </button>
  `;
}
</script>



</body>
</html>
