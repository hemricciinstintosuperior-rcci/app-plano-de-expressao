<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relatório Premium - Plano de Expressão</title>
<style>
    /* Design focado em leitura e sofisticação */
    body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; color:#222; background:#fff; line-height:1.7; margin:0; padding: 0; }
    #conteudo { width: 90%; max-width: 850px; margin: 0 auto; padding: 40px 20px; }

    /* Capa Impactante */
    .capa { text-align:center; padding: 80px 20px; page-break-after: always; border-bottom: 2px solid #eee; margin-bottom: 40px; }
    .logo { max-width:180px; margin-bottom:30px; border-radius: 20px; }
    .nomeCliente { font-size: 32px; font-weight: 800; color: #111827; text-transform: uppercase; letter-spacing: 2px; }
    .subtitulo { font-size: 20px; color: #6b7280; margin-top: 10px; }

    /* Seções e Títulos */
    .secao { margin-bottom: 50px; page-break-inside: avoid; }
    h2 { font-size: 24px; color: #111827; border-bottom: 3px solid #f3f4f6; padding-bottom: 10px; margin-bottom: 25px; text-transform: uppercase; }
    
    /* Gráficos Modernos */
    .grafico { background: #f9fafb; padding: 25px; border-radius: 15px; margin-bottom: 25px; }
    .barra { margin-bottom: 18px; }
    .barra span { font-weight: 600; font-size: 14px; text-transform: uppercase; color: #4b5563; display: block; margin-bottom: 5px; }
    .linha { width: 100%; height: 10px; background: #e5e7eb; border-radius: 20px; overflow: hidden; }
    .preenchimento { height: 100%; border-radius: 20px; transition: width 1s ease-in-out; }

    /* Cores do Sistema */
    .fisico { background: #ef4444; }
    .mental { background: #06b6d4; }
    .emocional { background: #22c55e; }
    .intuitivo { background: #eab308; }
    .criativo { background: #a855f7; }
    .indeciso { background: #f97316; }
    .neutro { background: #94a3b8; }

    /* FORMATAÇÃO DE TEXTO (O que você pediu) */
    .texto-analise { 
        font-size: 18px; 
        color: #374151; 
        white-space: pre-line; /* Respeita as quebras do JS */
        text-align: justify;
    }
    .texto-analise strong { color: #111; }
    
    /* Destaque para o Trânsito */
    .box-transito { 
        background: #fffbeb; 
        border-left: 6px solid #fbbf24; 
        padding: 30px; 
        border-radius: 0 15px 15px 0;
        font-size: 19px;
    }

    @media print {
        .capa { padding-top: 0; }
        #conteudo { width: 100%; padding: 0; }
        .secao { page-break-inside: avoid; }
    }
</style>
</head>
<body>

<div id="conteudo">Carregando relatório premium...</div>

<script>
const dadosSalvos = localStorage.getItem("relatorioMapa");
if(!dadosSalvos){
    document.getElementById("conteudo").innerHTML = "<h2>Erro: Nenhum mapa encontrado.</h2>";
} else {
    const rel = JSON.parse(dadosSalvos);
    const dataBr = rel.data.split('-').reverse().join('/');

    // Cálculo das escalas dos gráficos
    const maxNat = Math.max(rel.fisico, rel.mental, rel.emocional, rel.intuitivo);
    const maxExpNat = Math.max(rel.criativoNat, rel.indecisoNat, rel.neutroNat);
    const maxMom = Math.max(rel.fisicoMomento, rel.mentalMomento, rel.emocionalMomento, rel.intuitivoMomento);
    const maxExpMom = Math.max(rel.criativoMom, rel.indecisoMom, rel.neutroMom);

    document.getElementById("conteudo").innerHTML = `
        <div class="capa">
            <img class="logo" src="https://raw.githubusercontent.com/hemricciinstintosuperior-rcci/app-plano-de-expressao/main/icon-192.png">
            <div class="nomeCliente">${rel.nome}</div>
            <div class="subtitulo">Mapa Gerado em ${dataBr}</div>
        </div>

        <div class="secao">
            <h2>1. Perfil de Expressão Natural</h2>
            <div class="grafico">
                ${gerarBarra("Criativo", rel.criativoNat, maxExpNat, 'criativo')}
                ${gerarBarra("Indeciso", rel.indecisoNat, maxExpNat, 'indeciso')}
                ${gerarBarra("Neutro", rel.neutroNat, maxExpNat, 'neutro')}
            </div>
            <div class="texto-analise">${rel.textoExpressaoNat}</div>
        </div>

        <div class="secao">
            <h2>2. Plano de Expressão Estrutural</h2>
            <div class="grafico">
                ${gerarBarra("Físico", rel.fisico, maxNat, 'fisico')}
                ${gerarBarra("Mental", rel.mental, maxNat, 'mental')}
                ${gerarBarra("Emocional", rel.emocional, maxNat, 'emocional')}
                ${gerarBarra("Intuitivo", rel.intuitivo, maxNat, 'intuitivo')}
            </div>
            <div class="texto-analise">${rel.textoNatural}</div>
        </div>

        <div class="secao">
            <h2>3. Plano de Expressão do Momento (Ano ${rel.anoMomento})</h2>
            <div class="grafico">
                ${gerarBarra("Físico", rel.fisicoMomento, maxMom, 'fisico')}
                ${gerarBarra("Mental", rel.mentalMomento, maxMom, 'mental')}
                ${gerarBarra("Emocional", rel.emocionalMomento, maxMom, 'emocional')}
                ${gerarBarra("Intuitivo", rel.intuitivoMomento, maxMom, 'intuitivo')}
            </div>
            <div class="texto-analise">${rel.textoMomento}</div>
        </div>

        <div class="secao">
            <h2>4. Vibração de Trânsito Anual</h2>
            <div class="box-transito">
                ${rel.transitoHTML}
            </div>
        </div>

        <div style="text-align:center; color:#9ca3af; font-size:12px; margin-top:100px;">
            © Instinto Superior - Todos os direitos reservados.
        </div>
    `;

    // Pequeno delay para garantir que os gráficos carreguem antes do print
    setTimeout(() => { window.print(); }, 1200);
}

function gerarBarra(label, valor, maior, classe) {
    let pct = maior > 0 ? Math.max((valor / maior) * 100, 5) : 0;
    return `
        <div class="barra">
            <span>${label}</span>
            <div class="linha">
                <div class="preenchimento ${classe}" style="width:${pct}%;"></div>
            </div>
        </div>`;
}
</script>
</body>
</html>
