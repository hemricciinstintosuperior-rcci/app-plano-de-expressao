<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat√≥rio Premium</title>

<style>
body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
  padding:40px;
}

.card{
  background:#111827;
  padding:30px;
  border-radius:12px;
  max-width:700px;
  margin:auto;
}

.erro{ color:#ef4444; font-size:22px; }

#paginaRelatorio{
  width:210mm;
  margin:auto;
  background:white;
  color:black;
  font-family:Arial;
}

.folha{
  width:210mm;
  min-height:297mm;
  padding:25mm;
  box-sizing:border-box;
  page-break-after:always;
}

.page-break{ page-break-after:always; }

/* ===== MODO IMPRESS√ÉO (PDF) ===== */
/* ==============================
   AJUSTE PROFISSIONAL A4 CENTRALIZADO
   ============================== */
@media print {

  html, body{
    width:210mm;
    height:auto;
    margin:0 !important;
    padding:0 !important;
    background:white !important;
  }

  body{
    display:flex;
    justify-content:center;
  }

  .card{
    display:none !important;
  }

  #paginaRelatorio{
    width:210mm !important;
    margin:0 auto !important;
    padding:0 !important;
  }

  .folha{
    width:210mm !important;
    min-height:297mm !important;
    margin:0 auto !important;
    padding:18mm 15mm !important;
    box-sizing:border-box;
    page-break-after:always;
  }

  @page{
    size:A4 portrait;
    margin:0;
  }

}
</style>
</head>

<body>

<div class="card" id="conteudo">Carregando acesso...</div>

<script>
// ===============================
// CARREGAR DADOS DO MAPA
// ===============================
const dadosSalvos = localStorage.getItem("relatorioMapa");

if(!dadosSalvos){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>Nenhum mapa encontrado.<br>Volte e gere o mapa primeiro.</p>";
  throw new Error("Sem dados");
}

const relatorio = JSON.parse(dadosSalvos);

// ===============================
// SISTEMA TOKEN
// ===============================
const params = new URLSearchParams(window.location.search);
const token = params.get("token");

const tokensValidos = ["ABC123","MAPA777","CLIENTE001"];

if(!token || !tokensValidos.includes(token)){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>Acesso inv√°lido.</p>";
  throw new Error("Bloqueado");
}

// ===============================
// GERAR RELAT√ìRIO NA TELA
// ===============================
document.getElementById("conteudo").innerHTML = `
<div id="paginaRelatorio">

<div class="folha">

<h1 style="text-align:center;font-size:40px;margin-top:80px">
RELAT√ìRIO PREMIUM
</h1>

<h2 style="text-align:center;margin-bottom:120px">
Plano de Express√£o Cabal√≠stico
</h2>

<div class="page-break"></div>

<hr>
<h2>Dados do Cliente</h2>
<p><b>Nome:</b> ${relatorio.nome}</p>
<p><b>Data de nascimento:</b> ${relatorio.data}</p>
<hr>

<h2>O Plano de Express√£o</h2>
<p>
O Plano de Express√£o Cabal√≠stico revela como suas energias se distribuem
nos planos f√≠sico, mental, emocional e intuitivo.
</p>

<hr>

<h2>Distribui√ß√£o dos Planos</h2>
<p><b>F√≠sico:</b> ${relatorio.fisico}</p>
<p><b>Mental:</b> ${relatorio.mental}</p>
<p><b>Emocional:</b> ${relatorio.emocional}</p>
<p><b>Intuitivo:</b> ${relatorio.intuitivo}</p>

<hr>

<h2>Plano de Express√£o Natural</h2>
<p style="white-space:pre-line">${relatorio.textoNatural}</p>

<hr>

<h2>Status do Momento</h2>
<p><b>Vig√™ncia:</b> Ano ${relatorio.anoMomento}</p>
<p style="white-space:pre-line">${relatorio.textoMomento}</p>

<hr>
<h2>Encerramento</h2>
<p>
Este relat√≥rio representa um mapa simb√≥lico das suas tend√™ncias naturais.
Utilize estas informa√ß√µes como ferramenta de autoconhecimento e evolu√ß√£o.
</p>

</div>
</div>
`;

  </script>
  <script>
setTimeout(() => {
    window.print();
}, 2000);
// üöÄ GERAR PDF VIA IMPRESS√ÉO PROFISSIONAL (100% compat√≠vel Wix)
setTimeout(() => {

  // cria janela invis√≠vel
  const janela = window.open('', '_blank');

  // copia TODO o HTML pronto da tela
  const conteudo = document.documentElement.outerHTML;

  // escreve na nova janela
  janela.document.open();
  janela.document.write(conteudo);
  janela.document.close();

  // espera renderizar e manda imprimir
  janela.onload = () => {
    janela.focus();
    janela.print();
    janela.close();
  };

}, 2500);
// üìÑ GERA PDF AUTOMATICAMENTE
// üöÄ GERAR PDF SOMENTE QUANDO TUDO TERMINAR DE CARREGAR
window.onload = function gerarPDF(){

  const relatorioTela = document.body.innerHTML;
  const folha = document.getElementById("pdfFolha");

  // copia o relat√≥rio pronto para a folha A4 invis√≠vel
  folha.innerHTML = relatorioTela;

  const opt = {
    margin:0,
    filename:"Relatorio_Plano_Expressao.pdf",
    image:{ type:"jpeg", quality:1 },
    html2canvas:{ scale:2, useCORS:true },
    jsPDF:{ unit:"px", format:"a4", orientation:"portrait" }
  };

  setTimeout(()=>{
    html2pdf().set(opt).from(folha).save();
  },1000);

}

observer.observe(document.body, { childList:true, subtree:true });
</script>

</body>
</html>
