<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relatório Premium</title>

<style>

/* ================= TELA NORMAL ================= */

body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
  padding:40px;
}

.card{
  background:#111827;
  padding:30px;
  border-radius:12px;
  max-width:700px;
  margin:auto;
}

.erro{ color:#ef4444; font-size:22px; }
.ok{ color:#22c55e; font-size:22px; }

/* ================= FOLHA DO RELATÓRIO ================= */

.folha{
  width:210mm;
  min-height:297mm;
  background:white;
  color:black;
  padding:25mm;
  margin:20px auto;
  box-shadow:0 0 15px rgba(0,0,0,0.15);
  text-align:left;
}

h1{ font-size:34px; }
h2{ font-size:24px; margin-top:25px; }
p{ font-size:16px; line-height:1.7; }

.page-break{ page-break-after:always; }

/* ================= IMPRESSÃO PROFISSIONAL ================= */

@media print {

  body{
    background:white !important;
    padding:0 !important;
  }

  #conteudo{ display:none !important; }

  .folha{
    margin:0 !important;
    box-shadow:none !important;
    page-break-after:always;
  }

  h1,h2,h3{ page-break-after:avoid; }

  p{
    orphans:3;
    widows:3;
  }

  @page{
    size:A4;
    margin:18mm 15mm;
  }
}

</style>
</head>

<body>

<div class="card" id="conteudo">
Carregando acesso...
</div>

<script>

/* ================= CARREGAR DADOS ================= */

const dadosSalvos = localStorage.getItem("relatorioMapa");

if(!dadosSalvos){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>Nenhum mapa encontrado.<br>Volte e gere o mapa primeiro.</p>";
  throw new Error("Sem dados");
}

const relatorio = JSON.parse(dadosSalvos);

/* ================= PROTEÇÃO TOKEN ================= */

const params = new URLSearchParams(window.location.search);
const token = params.get("token");

const tokensValidos = ["ABC123","MAPA777","CLIENTE001"];

if(!token || !tokensValidos.includes(token)){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>Acesso inválido.</p>";
  throw new Error("Token inválido");
}

/* ================= GERAR RELATÓRIO ================= */

document.getElementById("conteudo").innerHTML =
"<p class='ok'>Relatório liberado. Preparando PDF...</p>";

document.body.insertAdjacentHTML("beforeend",`

<div id="paginaRelatorio">

<div class="folha">

<h1 style="text-align:center;margin-top:80px">RELATÓRIO PREMIUM</h1>
<h2 style="text-align:center;margin-bottom:120px">Plano de Expressão Cabalístico</h2>

<div class="page-break"></div>

<h2>Dados do Cliente</h2>
<p><b>Nome:</b> ${relatorio.nome}</p>
<p><b>Data de nascimento:</b> ${relatorio.data}</p>

<hr>

<h2>O Plano de Expressão</h2>
<p>
O Plano de Expressão Cabalístico revela como suas energias se organizam
nos quatro planos fundamentais: físico, mental, emocional e intuitivo.
</p>

<hr>

<h2>Distribuição dos Planos</h2>
<p><b>Físico:</b> ${relatorio.fisico}</p>
<p><b>Mental:</b> ${relatorio.mental}</p>
<p><b>Emocional:</b> ${relatorio.emocional}</p>
<p><b>Intuitivo:</b> ${relatorio.intuitivo}</p>

<hr>

<h2>Plano de Expressão Natural</h2>
<p style="white-space:pre-line">${relatorio.textoNatural}</p>

<hr>

<h2>Status do Momento</h2>
<p><b>Vigência:</b> Ano ${relatorio.anoMomento}</p>
<p style="white-space:pre-line">${relatorio.textoMomento}</p>

<hr>

<h2>Encerramento</h2>
<p>
Este relatório representa um mapa simbólico das suas tendências naturais.
Utilize como ferramenta de autoconhecimento e evolução.
</p>

</div>
</div>
`);

/* ================= GERAR PDF AUTOMÁTICO ================= */

window.onload = function(){
  setTimeout(()=>{ window.print(); },2500);
}

</script>
</body>
</html>
