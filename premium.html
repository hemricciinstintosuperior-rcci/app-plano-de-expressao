<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat√≥rio Premium</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
  padding:40px;
}

.card{
  background:#111827;
  padding:30px;
  border-radius:12px;
  max-width:700px;
  margin:auto;
}

button{
  padding:15px 25px;
  font-size:18px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#22c55e;
  color:white;
  margin-top:20px;
}

.erro{
  color:#ef4444;
  font-size:22px;
}

.ok{
  color:#22c55e;
  font-size:22px;
}
</style>
</head>

<body>

<div class="card" id="conteudo">
Carregando acesso...
</div>
<!-- AREA DO RELAT√ìRIO (fica escondida at√© gerar PDF) -->
<div id="relatorioPDF" style="display:none; background:white; color:black; padding:40px">

  <h1>RELAT√ìRIO PREMIUM</h1>
  <h2>Plano de Express√£o Cabal√≠stico</h2>

  <hr>

  <h2>DADOS DO CLIENTE</h2>
  <p id="pdfNome"></p>
  <p id="pdfData"></p>

  <hr>

  <h2>OS 4 PLANOS DA EXIST√äNCIA</h2>
  <p>
  Este relat√≥rio revela como sua energia se distribui entre os quatro planos
  fundamentais da exist√™ncia humana: f√≠sico, mental, emocional e intuitivo.
  </p>

  <div id="pdfResultados"></div>

</div>
<script>
// ===============================
// üì¶ 1) CARREGAR DADOS DO MAPA PRIMEIRO
// ===============================
const dadosSalvos = localStorage.getItem("relatorioMapa");

if(!dadosSalvos){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>Nenhum mapa encontrado.<br>Volte e gere o mapa primeiro.</p>";
  throw new Error("Sem dados do mapa");
}

const relatorio = JSON.parse(dadosSalvos);
console.log("Dados carregados:", relatorio);
 // ===============================
// üßæ PREENCHER RELAT√ìRIO PDF
// ===============================

// dados b√°sicos
document.getElementById("pdfNome").innerHTML =
  "<b>Nome:</b> " + relatorio.nome;

document.getElementById("pdfData").innerHTML =
  "<b>Data de nascimento:</b> " + relatorio.data;

// resultados dos planos
document.getElementById("pdfResultados").innerHTML = `
  <p><b>Plano F√≠sico:</b> ${relatorio.fisico}</p>
  <p><b>Plano Mental:</b> ${relatorio.mental}</p>
  <p><b>Plano Emocional:</b> ${relatorio.emocional}</p>
  <p><b>Plano Intuitivo:</b> ${relatorio.intuitivo}</p>
`; 
</script>

<script>
// =====================================
// üîê 2) SISTEMA DE PROTE√á√ÉO PREMIUM
// =====================================

// pega token da URL
const params = new URLSearchParams(window.location.search);
const token = params.get("token");

// lista de tokens v√°lidos (depois voc√™ altera manualmente)
const tokensValidos = [
  "ABC123",
  "MAPA777",
  "CLIENTE001"
];

// verifica se token existe
if(!token){
  bloquear("Acesso inv√°lido.");
}

// verifica se token √© v√°lido
if(!tokensValidos.includes(token)){
  bloquear("Token inv√°lido.");
}

// verifica se j√° foi usado
if(localStorage.getItem("token_usado_"+token)){
  bloquear("Este link j√° foi utilizado.");
}

// se chegou aqui ‚Üí acesso liberado
liberarAcesso();

function bloquear(msg){
  document.getElementById("conteudo").innerHTML =
  "<p class='erro'>"+msg+"</p>";
  throw new Error("Acesso bloqueado");
}

function liberarAcesso(){

  document.getElementById("conteudo").innerHTML = `
  <div id="paginaRelatorio" style="text-align:left;margin-top:30px">

  <!-- CAPA -->
  <h1 style="text-align:center;font-size:40px;margin-top:80px">
    RELAT√ìRIO PREMIUM
  </h1>

  <h2 style="text-align:center;margin-bottom:120px">
    Plano de Express√£o Cabal√≠stico
</h2>

<div style="page-break-after:always"></div>

<hr>
  <!-- DADOS -->
  <h2>Dados do Cliente</h2>
  <p><b>Nome:</b> ${relatorio.nome || "Cliente"}</p>
  <p><b>Data de nascimento:</b> ${relatorio.data || "-"}</p>

  <hr>

  <!-- INTRODU√á√ÉO -->
  <h2>O Plano de Express√£o</h2>
  <p>
  O Plano de Express√£o revela como a sua energia se manifesta nos quatro n√≠veis da exist√™ncia:
  f√≠sico, mental, emocional e intuitivo. Cada plano representa uma forma de perceber a vida,
  tomar decis√µes e interagir com o mundo.
  </p>

  <p>
  Este relat√≥rio apresenta a distribui√ß√£o da sua energia nesses quatro planos e a interpreta√ß√£o
  detalhada de cada um deles.
  </p>

  <hr>

  <!-- GR√ÅFICO (dados) -->
  <h2>Distribui√ß√£o dos Planos</h2>
  <p><b>F√≠sico:</b> ${relatorio.fisico || "-"}</p>
  <p><b>Mental:</b> ${relatorio.mental || "-"}</p>
  <p><b>Emocional:</b> ${relatorio.emocional || "-"}</p>
  <p><b>Intuitivo:</b> ${relatorio.intuitivo || "-"}</p>

  <hr>

  <!-- PLANOS -->
  <h2>Plano F√≠sico</h2>
  <p id="textoFisico">Texto f√≠sico ser√° inserido aqui.</p>

  <hr>

  <h2>Plano Mental</h2>
  <p id="textoMental">Texto mental ser√° inserido aqui.</p>

  <hr>

  <h2>Plano Emocional</h2>
  <p id="textoEmocional">Texto emocional ser√° inserido aqui.</p>

  <hr>

  <h2>Plano Intuitivo</h2>
  <p id="textoIntuitivo">Texto intuitivo ser√° inserido aqui.</p>

  <hr>

  <h2>Encerramento</h2>
  <p>
  Este relat√≥rio representa um mapa simb√≥lico das suas tend√™ncias naturais.
  Utilize estas informa√ß√µes como ferramenta de autoconhecimento e evolu√ß√£o.
  </p>

</div>
  `;
}
</script>

<script>
function gerarPDF(){

  // marca token como usado (bloqueia reuso)
  localStorage.setItem("token_usado_"+token, "sim");

  const elemento = document.createElement("div");

  elemento.innerHTML = `
  <div style="font-family:Arial;padding:40px">
    <h1>RELAT√ìRIO PREMIUM</h1>
    <hr>

    <h2>Nome:</h2>
    <p>${relatorio.nome}</p>

    <h2>Data de nascimento:</h2>
    <p>${relatorio.data}</p>

    <h2>Perfil geral:</h2>
    <p>${relatorio.perfil}</p>

    <hr>
    <h2>F√≠sico</h2>
    <p>${relatorio.fisicoTexto}</p>

    <h2>Mental</h2>
    <p>${relatorio.mentalTexto}</p>

    <h2>Emocional</h2>
    <p>${relatorio.emocionalTexto}</p>

    <h2>Intuitivo</h2>
    <p>${relatorio.intuitivoTexto}</p>

    <br><br>
    <h3>¬© Instituto RCCI</h3>
  </div>
  `;

  html2pdf().from(elemento).save("Relatorio_Premium.pdf");
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
function gerarPDF(){

  const elemento = document.getElementById("paginaRelatorio");

  const opcoes = {
    margin: 0,
    filename: "Relatorio_Premium.pdf",
    image: { type: "jpeg", quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
  };

  html2pdf().set(opcoes).from(elemento).save();

}
</script>
</body>
</html>
